/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cornerstoneRender"),require("gl-matrix"),require("vtk.js/Sources/Common/Core/Math"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("cornerstoneImageLoaderStreamingVolume")):"function"==typeof define&&define.amd?define(["cornerstoneRender","gl-matrix","vtk.js/Sources/Common/Core/Math","vtk.js/Sources/Common/Core/MatrixBuilder","cornerstoneImageLoaderStreamingVolume"],t):"object"==typeof exports?exports.cornerstoneTools=t(require("cornerstoneRender"),require("gl-matrix"),require("vtk.js/Sources/Common/Core/Math"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("cornerstoneImageLoaderStreamingVolume")):e.cornerstoneTools=t(e.window,e.window,e["vtk.js/Sources/Common/Core/Math"],e["vtk.js/Sources/Common/Core/MatrixBuilder"],e.window)}(this,(function(e,t,n,a,r){return function(){var o={907:function(e,t,n){e=n.nmd(e);var a="__lodash_hash_undefined__",r=9007199254740991,o="[object Arguments]",i="[object Boolean]",l="[object Date]",c="[object Function]",s="[object GeneratorFunction]",d="[object Map]",u="[object Number]",v="[object Object]",f="[object Promise]",h="[object RegExp]",g="[object Set]",m="[object String]",p="[object Symbol]",b="[object WeakMap]",w="[object ArrayBuffer]",E="[object DataView]",y="[object Float32Array]",_="[object Float64Array]",D="[object Int8Array]",C="[object Int16Array]",T="[object Int32Array]",U="[object Uint8Array]",S="[object Uint8ClampedArray]",I="[object Uint16Array]",k="[object Uint32Array]",M=/\w*$/,x=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,L={};L[o]=L["[object Array]"]=L[w]=L[E]=L[i]=L[l]=L[y]=L[_]=L[D]=L[C]=L[T]=L[d]=L[u]=L[v]=L[h]=L[g]=L[m]=L[p]=L[U]=L[S]=L[I]=L[k]=!0,L["[object Error]"]=L[c]=L[b]=!1;var A="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,R="object"==typeof self&&self&&self.Object===Object&&self,P=A||R||Function("return this")(),N=t&&!t.nodeType&&t,V=N&&e&&!e.nodeType&&e,B=V&&V.exports===N;function H(e,t){return e.set(t[0],t[1]),e}function j(e,t){return e.add(t),e}function W(e,t,n,a){var r=-1,o=e?e.length:0;for(a&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function F(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e,a){n[++t]=[a,e]})),n}function z(e,t){return function(n){return e(t(n))}}function q(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var K,Y=Array.prototype,X=Function.prototype,$=Object.prototype,J=P["__core-js_shared__"],Z=(K=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",Q=X.toString,ee=$.hasOwnProperty,te=$.toString,ne=RegExp("^"+Q.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ae=B?P.Buffer:void 0,re=P.Symbol,oe=P.Uint8Array,ie=z(Object.getPrototypeOf,Object),le=Object.create,ce=$.propertyIsEnumerable,se=Y.splice,de=Object.getOwnPropertySymbols,ue=ae?ae.isBuffer:void 0,ve=z(Object.keys,Object),fe=Pe(P,"DataView"),he=Pe(P,"Map"),ge=Pe(P,"Promise"),me=Pe(P,"Set"),pe=Pe(P,"WeakMap"),be=Pe(Object,"create"),we=je(fe),Ee=je(he),ye=je(ge),_e=je(me),De=je(pe),Ce=re?re.prototype:void 0,Te=Ce?Ce.valueOf:void 0;function Ue(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function Se(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function Ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}function ke(e){this.__data__=new Se(e)}function Me(e,t,n){var a=e[t];ee.call(e,t)&&We(a,n)&&(void 0!==n||t in e)||(e[t]=n)}function xe(e,t){for(var n=e.length;n--;)if(We(e[n][0],t))return n;return-1}function Oe(e,t,n,a,r,f,b){var x;if(a&&(x=f?a(e,r,f,b):a(e)),void 0!==x)return x;if(!Ke(e))return e;var O=Fe(e);if(O){if(x=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ee.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!t)return function(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t}(e,x)}else{var A=Ve(e),R=A==c||A==s;if(ze(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(A==v||A==o||R&&!f){if(F(e))return f?e:{};if(x=function(e){return"function"!=typeof e.constructor||He(e)?{}:Ke(t=ie(e))?le(t):{};var t}(R?{}:e),!t)return function(e,t){return Ae(e,Ne(e),t)}(e,function(e,t){return e&&Ae(t,Ye(t),e)}(x,e))}else{if(!L[A])return f?e:{};x=function(e,t,n,a){var r,o=e.constructor;switch(t){case w:return Le(e);case i:case l:return new o(+e);case E:return function(e,t){var n=t?Le(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,a);case y:case _:case D:case C:case T:case U:case S:case I:case k:return function(e,t){var n=t?Le(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,a);case d:return function(e,t,n){return W(t?n(G(e),!0):G(e),H,new e.constructor)}(e,a,n);case u:case m:return new o(e);case h:return function(e){var t=new e.constructor(e.source,M.exec(e));return t.lastIndex=e.lastIndex,t}(e);case g:return function(e,t,n){return W(t?n(q(e),!0):q(e),j,new e.constructor)}(e,a,n);case p:return r=e,Te?Object(Te.call(r)):{}}}(e,A,Oe,t)}}b||(b=new ke);var P=b.get(e);if(P)return P;if(b.set(e,x),!O)var N=n?function(e){return function(e,t,n){var a=t(e);return Fe(e)?a:function(e,t){for(var n=-1,a=t.length,r=e.length;++n<a;)e[r+n]=t[n];return e}(a,n(e))}(e,Ye,Ne)}(e):Ye(e);return function(e,t){for(var n=-1,a=e?e.length:0;++n<a&&!1!==t(e[n],n););}(N||e,(function(r,o){N&&(r=e[o=r]),Me(x,o,Oe(r,t,n,a,o,e,b))})),x}function Le(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Ae(e,t,n,a){n||(n={});for(var r=-1,o=t.length;++r<o;){var i=t[r],l=a?a(n[i],e[i],i,n,e):void 0;Me(n,i,void 0===l?e[i]:l)}return n}function Re(e,t){var n,a,r=e.__data__;return("string"==(a=typeof(n=t))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function Pe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ke(e)||(t=e,Z&&Z in t))&&(qe(e)||F(e)?ne:x).test(je(e));var t}(n)?n:void 0}Ue.prototype.clear=function(){this.__data__=be?be(null):{}},Ue.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Ue.prototype.get=function(e){var t=this.__data__;if(be){var n=t[e];return n===a?void 0:n}return ee.call(t,e)?t[e]:void 0},Ue.prototype.has=function(e){var t=this.__data__;return be?void 0!==t[e]:ee.call(t,e)},Ue.prototype.set=function(e,t){return this.__data__[e]=be&&void 0===t?a:t,this},Se.prototype.clear=function(){this.__data__=[]},Se.prototype.delete=function(e){var t=this.__data__,n=xe(t,e);return!(n<0||(n==t.length-1?t.pop():se.call(t,n,1),0))},Se.prototype.get=function(e){var t=this.__data__,n=xe(t,e);return n<0?void 0:t[n][1]},Se.prototype.has=function(e){return xe(this.__data__,e)>-1},Se.prototype.set=function(e,t){var n=this.__data__,a=xe(n,e);return a<0?n.push([e,t]):n[a][1]=t,this},Ie.prototype.clear=function(){this.__data__={hash:new Ue,map:new(he||Se),string:new Ue}},Ie.prototype.delete=function(e){return Re(this,e).delete(e)},Ie.prototype.get=function(e){return Re(this,e).get(e)},Ie.prototype.has=function(e){return Re(this,e).has(e)},Ie.prototype.set=function(e,t){return Re(this,e).set(e,t),this},ke.prototype.clear=function(){this.__data__=new Se},ke.prototype.delete=function(e){return this.__data__.delete(e)},ke.prototype.get=function(e){return this.__data__.get(e)},ke.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Se){var a=n.__data__;if(!he||a.length<199)return a.push([e,t]),this;n=this.__data__=new Ie(a)}return n.set(e,t),this};var Ne=de?z(de,Object):function(){return[]},Ve=function(e){return te.call(e)};function Be(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||O.test(e))&&e>-1&&e%1==0&&e<t}function He(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||$)}function je(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(fe&&Ve(new fe(new ArrayBuffer(1)))!=E||he&&Ve(new he)!=d||ge&&Ve(ge.resolve())!=f||me&&Ve(new me)!=g||pe&&Ve(new pe)!=b)&&(Ve=function(e){var t=te.call(e),n=t==v?e.constructor:void 0,a=n?je(n):void 0;if(a)switch(a){case we:return E;case Ee:return d;case ye:return f;case _e:return g;case De:return b}return t});var Fe=Array.isArray;function Ge(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!qe(e)}var ze=ue||function(){return!1};function qe(e){var t=Ke(e)?te.call(e):"";return t==c||t==s}function Ke(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ye(e){return Ge(e)?function(e,t){var n=Fe(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ge(e)}(e)&&ee.call(e,"callee")&&(!ce.call(e,"callee")||te.call(e)==o)}(e)?function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a}(e.length,String):[],a=n.length,r=!!a;for(var i in e)!t&&!ee.call(e,i)||r&&("length"==i||Be(i,a))||n.push(i);return n}(e):function(e){if(!He(e))return ve(e);var t=[];for(var n in Object(e))ee.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Oe(e,!0,!0)}},812:function(e){"use strict";e.exports=n},653:function(e){"use strict";e.exports=a},708:function(e){"use strict";e.exports=r},45:function(t){"use strict";t.exports=e},167:function(e){"use strict";e.exports=t}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return o[e](n,n.exports,l),n.loaded=!0,n.exports}l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,{a:t}),t},l.d=function(e,t){for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var c={};return function(){"use strict";l.r(c),l.d(c,{BaseAnnotationTool:function(){return Pn},BaseTool:function(){return Mn},BidirectionalTool:function(){return ia},CornerstoneTools3DEvents:function(){return _},CrosshairsTool:function(){return ra},EllipticalRoiTool:function(){return da},FrameOfReferenceSpecificToolStateManager:function(){return h},LengthTool:function(){return la},MIPJumpToClickTool:function(){return oa},PanTool:function(){return Nn},PetThresholdTool:function(){return jn},ProbeTool:function(){return ca},RectangleRoiTool:function(){return sa},StackScrollMouseWheelTool:function(){return Fn},StackScrollTool:function(){return Wn},SynchronizerManager:function(){return Ot},ToolBindings:function(){return p},ToolGroupManager:function(){return kt},VolumeRotateMouseWheelTool:function(){return qn},WindowLevelTool:function(){return Bn},ZoomTool:function(){return Gn},addTool:function(){return Z},addToolState:function(){return cn},defaultFrameOfReferenceSpecificToolStateManager:function(){return g},drawing:function(){return Cn},getStyle:function(){return sn},getToolDataNearPoint:function(){return Lt},getToolDataNearPointOnEnabledElement:function(){return At},getToolState:function(){return ln},init:function(){return fn},resetToolsState:function(){return Q},setGlobalStyle:function(){return dn},setToolDataStyle:function(){return vn},setToolStyle:function(){return un},synchronizers:function(){return kn},toolDataSelection:function(){return t},toolStyle:function(){return e}});var e={};l.r(e),l.d(e,{getDefaultStyleProperty:function(){return U},getFont:function(){return S},getStyleAlternatives:function(){return C},getStyleProperty:function(){return T},initializeDefaultStyleAlternatives:function(){return D}});var t={};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}l.r(t),l.d(t,{deselectToolData:function(){return Xe},getSelectedToolData:function(){return $e},getSelectedToolDataByUID:function(){return Je},getSelectionSize:function(){return Qe},isToolDataSelected:function(){return Ze},selectToolData:function(){return Ye}});var s,d,u=l(907),v=l.n(u),f=l(45),h=function(){function e(t){var a=this;n(this,e),o(this,"toolState",void 0),o(this,"uid",void 0),o(this,"_imageVolumeModifiedHandler",(function(e){var t=e.detail.FrameOfReferenceUID,n=a.toolState[t];n&&Object.keys(n).forEach((function(e){n[e].forEach((function(e){var t=e.data;t&&void 0!==t.invalidated&&(t.invalidated=!0)}))}))})),o(this,"get",(function(e,t){var n=a.toolState[e];if(n)return n[t]})),o(this,"getToolStateByToolUID",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a._getToolSpecificToolStateAndIndex(e,t);if(n){var r=n.toolSpecificToolState,o=n.index;return r[o]}})),o(this,"addToolState",(function(e){var t=e.metadata,n=t.FrameOfReferenceUID,r=t.toolName,o=a.toolState,i=o[n];i||(o[n]={},i=o[n]);var l=i[r];l||(i[r]=[],l=i[r]),l.push(e)})),o(this,"removeToolState",(function(e){var t=e.metadata,n=t.FrameOfReferenceUID,r=t.toolName,o=t.toolUID,i=a.toolState[n];if(!i)throw new Error("frameOfReferenceSpecificToolState with FrameOfReferenceUID ".concat(n," does not exist."));var l=i[r];if(!l)throw new Error("toolSpecificToolState for toolName ".concat(r," on FrameOfReferenceUID ").concat(n," does not exist."));var c=l.findIndex((function(e){return e.metadata.toolUID===o}));l.splice(c,1)})),o(this,"removeToolStateByToolUID",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a._getToolSpecificToolStateAndIndex(e,t);if(n){var r=n.toolSpecificToolState,o=n.index;r.splice(o,1)}})),o(this,"saveToolState",(function(e,t){var n=a.toolState;if(e&&t){var r=n[e];if(!r)return;var o=r[t];return v()(o)}if(e){var i=n[e];return v()(i)}return v()(n)})),o(this,"restoreToolState",(function(e,t,n){var r=a.toolState;if(t&&n){var o=r[t];o||(r[t]={},o=r[t]),o[n]=e}else t?r[t]=e:a.toolState=e})),t||(t=i()),this.toolState={},this.uid=t,f.eventTarget.addEventListener(f.EVENTS.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}return r(e,[{key:"_getToolSpecificToolStateAndIndex",value:function(e,t){for(var n,a=t.toolName,r=t.FrameOfReferenceUID,o=this.toolState,i=(n=r?[r]:Object.keys(o)).length,l=0;l<i;l++)for(var c,s=o[n[l]],d=(c=a?[a]:Object.keys(s)).length,u=0;u<d;u++){var v=s[c[u]],f=v.findIndex((function(t){return t.metadata.toolUID===e}));if(-1!==f)return{toolSpecificToolState:v,index:f}}}}]),e}(),g=new h("DEFAULT");!function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button"}(s||(s={})),d||(d={});var m,p={Mouse:s,Touch:d};!function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(m||(m={}));var b,w=m;!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked"}(b||(b={}));var E,y=b;!function(e){e.MOUSE_DOWN="cornerstonetools3dmousedown",e.MOUSE_UP="cornerstonetools3dmouseup",e.MOUSE_DOWN_ACTIVATE="cornerstonetools3dmousedownactivate",e.MOUSE_DRAG="cornerstonetools3dmousedrag",e.MOUSE_MOVE="cornerstonetools3dmousemove",e.MOUSE_CLICK="cornerstonetools3dmouseclick",e.MOUSE_DOUBLE_CLICK="cornerstonetools3dmousedoubleclick",e.MOUSE_WHEEL="cornerstonetools3dmousewheel",e.TOUCH_START="cornerstonetools3dtouchstart",e.TOUCH_START_ACTIVE="cornerstonetools3dtouchstartactive",e.TOUCH_END="cornerstonetools3dtouchend",e.TOUCH_DRAG="cornerstonetools3dtouchdrag",e.TOUCH_DRAG_END="cornerstonetools3dtouchdragend",e.TOUCH_PINCH="cornerstonetools3dtouchpinch",e.TOUCH_ROTATE="cornerstonetools3dtouchrotate",e.TOUCH_PRESS="cornerstonetools3dtouchpress",e.TAP="cornerstonetools3dtap",e.DOUBLE_TAP="cornerstonetools3ddoubletap",e.MULTI_TOUCH_START="cornerstonetools3dmultitouchstart",e.MULTI_TOUCH_START_ACTIVE="cornerstonetools3dmultitouchstartactive",e.MULTI_TOUCH_DRAG="cornerstonetools3dmultitouchdrag",e.KEY_DOWN="cornerstonetools3dkeydown",e.KEY_UP="cornerstonetools3dkeyup",e.KEY_PRESS="cornerstonetools3dkeypress",e.MEASUREMENT_SELECTION_CHANGE="cornerstonetools3dmeasurementselectionchange"}(E||(E={}));var _=E;function D(){var e=["",w.Active,w.Passive],t=[y.Default,y.Highlighted,y.Selected,y.Locked],n=f.Settings.getDefaultSettings();n.forEach((function(a){var r=function(e){return e.length>0&&a.endsWith(e)};t.some(r)||e.some(r)||t.forEach((function(t){e.forEach((function(e){var r="".concat(a).concat(t).concat(e);n.set(r,n.get(r))}))}))}))}function C(e,t,n){var a=["tool.style.".concat(e)];return t&&a.push("".concat(a[0]).concat(t)),n&&a.push("".concat(a[a.length-1]).concat(n)),a}function T(e,t,n,a){for(var r=C(t,n,a),o=r.length-1;o>=0;--o){var i=e.get(r[o]);if(void 0!==i)return i}}function U(e,t,n){return T(f.Settings.getRuntimeSettings(),e,t,n)}function S(e,t,n){var a=f.Settings.assert(e),r=T(a,"textBox.fontSize",t,n),o=T(a,"textBox.fontFamily",t,n);return"".concat(r,"px ").concat(o)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function k(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var a,r,o=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw r}}return o}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){var n=[0,0],a=Number.MAX_SAFE_INTEGER;return e.forEach((function(e){var r,o,i,l,c,s,d,u=(r=e,i=(o=M(t,2))[0],l=o[1],s=(c=M(r,2))[0],d=c[1],Math.sqrt(Math.pow(i-s,2)+Math.pow(l-d,2)));u<a&&(a=u,n=x(e))})),n}f.Settings.getDefaultSettings().set("tool.style",{color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 255, 0)",colorLocked:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"",textBox:{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 255, 0)",colorLocked:"rgb(255, 255, 0)",background:"",link:{lineWidth:"1",lineDash:"2,3"}}}),D();var L=1e-6;function A(e,t,n){var a=M(n,2),r=a[0],o=a[1];if(Math.abs(t)<L)return e<0;var i=e/t;if(t>0){if(i>o)return 0;i>r&&(n[0]=i)}else{if(i<r)return 0;i<o&&(n[1]=i)}return 1}var R={isEqual:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5;return Math.abs(e[0]-t[0])<n&&Math.abs(e[1]-t[1])<n},findClosestPoint:O,liangBarksyClip:function(e,t,n,a,r){var o=M(e,2),i=o[0],l=o[1],c=M(t,2),s=c[0]-i,d=c[1]-l;if(void 0===a||void 0===r?(a=e,r=t):(a[0]=e[0],a[1]=e[1],r[0]=t[0],r[1]=t[1]),Math.abs(s)<L&&Math.abs(d)<L&&i>=n[0]&&i<=n[2]&&l>=n[1]&&l<=n[3])return 1;var u=[0,1];if(A(n[0]-i,s,u)&&A(i-n[2],-s,u)&&A(n[1]-l,d,u)&&A(l-n[3],-d,u)){var v=u[0],f=u[1];return f<1&&(r[0]=i+f*s,r[1]=l+f*d),v>0&&(a[0]+=v*s,a[1]+=v*d),1}return 0}};function P(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return!1;var r=[e.left+n,e.top+a],o=[t[0]-r[0],t[1]-r[1]];return o[0]*o[0]/(n*n)+o[1]*o[1]/(a*a)<=1}function N(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function V(e,t,n){var a=N(e,t);if(0===a)return N(n,e);var r=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/a;return N(n,r<0?e:r>1?t:[e[0]+r*(t[0]-e[0]),e[1]+r*(t[1]-e[1])])}function B(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}var H={distanceToPoint:function(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(V(e,t,n))},distanceToPointSquared:V,intersectLine:function(e,t,n,a){var r=M(e,2),o=r[0],i=r[1],l=M(t,2),c=l[0],s=l[1],d=M(n,2),u=d[0],v=d[1],f=M(a,2),h=f[0],g=f[1],m=s-i,p=o-c,b=c*i-o*s,w=m*u+p*v+b,E=m*h+p*g+b;if(0===w||0===E||B(w)!==B(E)){var y=g-v,_=u-h,D=h*v-u*g,C=y*o+_*i+D,T=y*c+_*s+D;if(0===C||0===T||B(C)!==B(T)){var U=m*_-y*p;return[(p*D-_*b)/U,(y*b-m*D)/U]}}}},j={distanceToPoint:function(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");var n=M(e,4),a=n[0],r=n[1],o=n[2],i=n[3],l=655535,c=function(e,t,n,a){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+a]],bottom:[[e+n,t+a],[e,t+a]],left:[[e,t+a],[e,t]]}}(a,r,o,i);return Object.keys(c).forEach((function(e){var n=M(c[e],2),a=n[0],r=n[1],o=H.distanceToPoint(a,r,t);o<l&&(l=o)})),l}},W={vec2:R,vec3:{isEqual:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5;return Math.abs(e[0]-t[0])<n&&Math.abs(e[1]-t[1])<n&&Math.abs(e[2]-t[2])<n},isOpposite:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5;return Math.abs(e[0]+t[0])<n&&Math.abs(e[1]+t[1])<n&&Math.abs(e[2]+t[2])<n}},ellipse:{pointInEllipse:P},lineSegment:H,rectangle:j},F=l(167);function G(e,t){var n=e.direction,a=e.spacing,r=n.slice(0,3),o=n.slice(3,6),i=n.slice(6,9),l=[F.vec3.dot(r,t),F.vec3.dot(o,t),F.vec3.dot(i,t)],c=F.vec3.create();return F.vec3.set(c,l[0]*a[0],l[1]*a[1],l[2]*a[2]),F.vec3.length(c)}function z(e,t,n){var a=t.viewPlaneNormal,r=e.getVolumeActors();if(!r&&!r.length)return{spacingInNormalDirection:null,imageVolume:null};var o=r.length,i=r.map((function(e){return f.cache.getVolume(e.uid)}));if(n){var l=i.find((function(e){return e.uid===n}));return{imageVolume:l,spacingInNormalDirection:G(l,a)}}for(var c={spacingInNormalDirection:1/0,imageVolume:null},s=0;s<o;s++){var d=i[s],u=G(d,a);u<c.spacingInNormalDirection&&(c.spacingInNormalDirection=u,c.imageVolume=d)}return c}function q(e,t,n){var a=t.viewPlaneNormal,r=e.filter((function(e){var t=e.metadata.viewPlaneNormal;return W.vec3.isEqual(t,a)}));if(!r.length)return[];for(var o=n/2,i=t.focalPoint,l=[],c=0;c<r.length;c++){var s=r[c],d=s.data.handles.points[0],u=F.vec3.create();F.vec3.sub(u,i,d);var v=F.vec3.dot(u,a);Math.abs(v)<o&&l.push(s)}return l}function K(e,t,n,a,r){var o,i,l=n.direction,c=l.slice(0,3),s=l.slice(3,6),d=l.slice(6,9),u=F.vec3.create();if(F.vec3.cross(u,t,e),u=[-u[0],-u[1],-u[2]],Math.abs(F.vec3.dot(c,t))>.999)o=0;else if(Math.abs(F.vec3.dot(s,t))>.999)o=1;else{if(!(Math.abs(F.vec3.dot(d,t))>.999))return console.warn("Can only currently do area calculation for orthogonal views."),{worldWidth:0,worldHeight:0};o=2}if(Math.abs(F.vec3.dot(c,u))>.999)i=0;else if(Math.abs(F.vec3.dot(s,u))>.999)i=1;else{if(!(Math.abs(F.vec3.dot(d,u))>.999))return console.warn("Can only currently do area calculation for orthogonal views."),{worldWidth:0,worldHeight:0};i=2}return{worldWidth:Math.abs(a[o]-r[o]),worldHeight:Math.abs(a[i]-r[i])}}var Y=l(812),X=l.n(Y);var $=function(e,t){var n=M(t,6),a=n[0],r=n[1],o=n[2],i=n[3],l=n[4],c=n[5];return e[0]>a&&e[0]<r&&e[1]>o&&e[1]<i&&e[2]>l&&e[2]<c};var J={isToolLocked:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:{},enabledElements:[],handleRadius:6};function Z(e,t){var n=new e(t),a=void 0!==n.name&&""!==n.name,r=void 0!==J.tools[n.name];a?r?console.warn("".concat(n.name," has already been added globally")):J.tools[n.name]={toolClass:e,toolOptions:t}:console.warn("Tool with configuration did not produce a toolName: ",t)}function Q(){J.tools={},J.toolGroups=[],J.synchronizers=[],J.enabledElements=[],J.isToolLocked=!1,J.isMultiPartToolActive=!1,J.handleRadius=6}function ee(e,t){var n=t||e.target,a=(0,f.getEnabledElement)(n),r=function(e){return[e.pageX,e.pageY]}(e),o=function(e,t){var n=e.getBoundingClientRect();return[t[0]-n.left-window.pageXOffset,t[1]-n.top-window.pageYOffset]}(n,r),i=a.viewport.canvasToWorld(o);return{page:r,client:te(e),canvas:o,world:i}}function te(e){return[e.clientX,e.clientY]}var ne=function(e){var t=e.target,n=ee(e,t),a={event:e,camera:{},element:t,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},eventName:_.MOUSE_DOUBLE_CLICK};(0,f.triggerEvent)(t,_.MOUSE_DOUBLE_CLICK,a)},ae=_.MOUSE_MOVE,re=function(e){var t=e.currentTarget,n=(0,f.getEnabledElement)(t),a={renderingEngineUID:n.renderingEngineUID,sceneUID:n.sceneUID,viewportUID:n.viewportUID,camera:{},element:t,currentPoints:ee(e),eventName:ae};(0,f.triggerEvent)(t,ae,a)},oe=_.MOUSE_DOWN,ie=_.MOUSE_DOWN_ACTIVATE,le={renderingEngingUID:void 0,sceneUID:void 0,viewportUID:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,element:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}},ce={renderingEngingUID:void 0,sceneUID:void 0,viewportUID:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};function se(e){var t=ee(e,ce.element),n=function(e,t){var n=e,a=(0,f.getEnabledElement)(n).viewport.canvasToWorld(t.canvas);return{page:t.page,client:t.client,canvas:t.canvas,world:a}}(ce.element,ce.lastPoints),a=he(t,n),r={renderingEngineUID:ce.renderingEngingUID,sceneUID:ce.sceneUID,viewportUID:ce.viewportUID,event:e,camera:{},element:ce.element,startPoints:ve(ce.startPoints),lastPoints:ve(n),currentPoints:t,deltaPoints:a,eventName:_.MOUSE_DRAG};(0,f.triggerEvent)(ce.element,_.MOUSE_DRAG,r),ce.lastPoints=ve(t)}function de(e){clearTimeout(ce.preventClickTimeout);var t=ce.isClickEvent?_.MOUSE_CLICK:_.MOUSE_UP,n=ee(e,ce.element),a=he(n,ce.lastPoints),r={renderingEngineUID:ce.renderingEngingUID,sceneUID:ce.sceneUID,viewportUID:ce.viewportUID,event:e,camera:{},element:ce.element,startPoints:ve(ce.startPoints),lastPoints:ve(ce.lastPoints),currentPoints:n,deltaPoints:a,eventName:t};(0,f.triggerEvent)(r.element,t,r),document.removeEventListener("mousemove",se),document.removeEventListener("mouseup",de),ce.element.addEventListener("mousemove",re),ce=JSON.parse(JSON.stringify(le))}function ue(){ce.isClickEvent=!1}function ve(e){return JSON.parse(JSON.stringify(e))}function fe(e,t){return[e[0]-t[0],e[1]-t[1]]}function he(e,t){return{page:fe(e.page,t.page),client:fe(e.client,t.client),canvas:fe(e.canvas,t.canvas),world:(n=e.world,a=t.world,[n[0]-a[0],n[1]-a[1],n[2]-a[2]])};var n,a}var ge=function(e){ce.element=e.target;var t=(0,f.getEnabledElement)(ce.element),n=t.renderingEngineUID,a=t.sceneUID,r=t.viewportUID;ce.renderingEngingUID=n,ce.sceneUID=a,ce.viewportUID=r,ce.preventClickTimeout=setTimeout(ue,ce.clickDelay),ce.element.removeEventListener("mousemove",re);var o=ee(e,ce.element),i=he(o,o),l={renderingEngineUID:ce.renderingEngingUID,sceneUID:ce.sceneUID,viewportUID:ce.viewportUID,event:e,camera:{},element:ce.element,startPoints:o,lastPoints:o,currentPoints:o,deltaPoints:i,eventName:oe};ce.startPoints=ve(l.startPoints),ce.lastPoints=ve(l.lastPoints),(0,f.triggerEvent)(l.element,oe,l)&&(l.eventName=ie,(0,f.triggerEvent)(l.element,ie,l)),document.addEventListener("mousemove",se),document.addEventListener("mouseup",de)};function me(e){e.removeEventListener("dblclick",ne),e.removeEventListener("mousedown",ge),e.removeEventListener("mousemove",re)}var pe={enable:function(e){me(e),e.addEventListener("dblclick",ne),e.addEventListener("mousedown",ge),e.addEventListener("mousemove",re)},disable:me},be=function(e){var t=e.currentTarget,n=(0,f.getEnabledElement)(t),a=n.renderingEngineUID,r=n.sceneUID,o=n.viewportUID;if(!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var i=function(e){var t=0,n=0,a=0,r=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),a=10*t,r=10*n,"deltaY"in e&&(r=e.deltaY),"deltaX"in e&&(a=e.deltaX),(a||r)&&e.deltaMode&&(1===e.deltaMode?(a*=40,r*=40):(a*=800,r*=800)),a&&!t&&(t=a<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:t,spinY:n,pixelX:a,pixelY:r}}(e),l=i.spinX,c=i.spinY,s={renderingEngineUID:a,sceneUID:r,viewportUID:o,element:t,camera:{},detail:e,wheel:{spinX:l,spinY:c,pixelX:i.pixelX,pixelY:i.pixelY,direction:c<0?-1:1},points:ee(e)};(0,f.triggerEvent)(t,_.MOUSE_WHEEL,s)}};function we(e){e.removeEventListener("wheel",be)}var Ee={enable:function(e){we(e),e.addEventListener("wheel",be,{passive:!1})},disable:we};function ye(e,t){if(J.svgNodeCache[e][t])return J.svgNodeCache[e][t].domRef}function _e(e,t,n,a){J.svgNodeCache[t][a]={touched:!0,domRef:n},e.appendChild(n)}function De(e,t){J.svgNodeCache[e][t]&&(J.svgNodeCache[e][t].touched=!0)}function Ce(e,t){Object.keys(J.svgNodeCache[t]).forEach((function(n){var a=J.svgNodeCache[t][n];!a.touched&&a.domRef&&(e.removeChild(a.domRef),delete J.svgNodeCache[t][n])}))}var Te=function(e,t){var n=function(e){var t=(0,f.getEnabledElement)(e),n=t.viewportUID,a=t.sceneUID,r=t.renderingEngineUID,o="".concat(n,":").concat(a,":").concat(r),i=function(e){return e.parentNode.querySelector(".svg-layer")}(e);return Object.keys(J.svgNodeCache[o]).forEach((function(e){J.svgNodeCache[o][e].touched=!1})),{enabledElement:t,_canvasElement:e,_svgLayerElement:i,_svgNodeCacheForCanvas:J.svgNodeCache,_getSvgNode:ye.bind(this,o),_appendNode:_e.bind(this,i,o),_setNodeTouched:De.bind(this,o),_clearUntouched:Ce.bind(this,i,o)}}(e);t(n),n._clearUntouched()},Ue=function(e,t,n,a){return"".concat(e,"::").concat(t,"::").concat(n,"::").concat(a)},Se=function(e,t,n,a,r,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},i),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=d||s,f="http://www.w3.org/2000/svg",h=Ue(t,n,"ellipse",a),g=e._getSvgNode(h),m=Math.abs(r[0]-o[0]),p=Math.abs(r[1]-o[1]),b=Math.min(r[0],o[0]),w=Math.min(r[1],o[1]),E=[b+m/2,w+p/2],y=m/2,_=p/2;if(g)g.setAttribute("cx","".concat(E[0])),g.setAttribute("cy","".concat(E[1])),g.setAttribute("rx","".concat(y)),g.setAttribute("ry","".concat(_)),g.setAttribute("stroke",c),g.setAttribute("stroke-width",v),u?g.setAttribute("stroke-dasharray",u):g.removeAttribute("stroke-dasharray"),e._setNodeTouched(h);else{var D=document.createElementNS(f,"ellipse");D.setAttribute("cx","".concat(E[0])),D.setAttribute("cy","".concat(E[1])),D.setAttribute("rx","".concat(y)),D.setAttribute("ry","".concat(_)),D.setAttribute("fill","transparent"),D.setAttribute("stroke",c),D.setAttribute("stroke-width",v),u&&D.setAttribute("stroke-dasharray",u),e._appendNode(D,h)}},Ie=function(e,t,n,a,r){for(var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=Object.assign({color:"dodgerblue",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle"},o),l=i.color,c=i.handleRadius,s=i.width,d=i.lineWidth,u=i.fill,v=i.type,f=d||s,h=0;h<r.length;h++){var g=r[h],m="http://www.w3.org/2000/svg",p=Ue(t,n,"handle","hg-".concat(a,"-index-").concat(h)),b=e._getSvgNode(p);if(b){if("circle"===v)b.setAttribute("cx","".concat(g[0])),b.setAttribute("cy","".concat(g[1])),b.setAttribute("r",c),b.setAttribute("stroke",l),b.setAttribute("fill",u),b.setAttribute("stroke-width",f);else if("rect"===v){var w=parseFloat(c),E=1.5*w,y=g[0]-.5*E,_=g[1]-.5*E;b.setAttribute("x","".concat(y)),b.setAttribute("y","".concat(_)),b.setAttribute("width","".concat(E)),b.setAttribute("height","".concat(E)),b.setAttribute("stroke",l),b.setAttribute("fill",u),b.setAttribute("stroke-width",f),b.setAttribute("rx","".concat(.1*E))}e._setNodeTouched(p)}else{var D=document.createElementNS(m,v);if("circle"===v)D.setAttribute("cx","".concat(g[0])),D.setAttribute("cy","".concat(g[1])),D.setAttribute("r",c),D.setAttribute("stroke",l),D.setAttribute("fill",u),D.setAttribute("stroke-width",f);else if("rect"===v){var C=parseFloat(c),T=1.5*C,U=g[0]-.5*T,S=g[1]-.5*T;D.setAttribute("x","".concat(U)),D.setAttribute("y","".concat(S)),D.setAttribute("width","".concat(T)),D.setAttribute("height","".concat(T)),D.setAttribute("stroke",l),D.setAttribute("fill",u),D.setAttribute("stroke-width",f),D.setAttribute("rx","".concat(.1*T))}else console.warn("handle type not valid");e._appendNode(D,p)}}};function ke(e,t,n,a,r,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},i),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=d||s,f="http://www.w3.org/2000/svg",h=Ue(t,n,"line",a),g=e._getSvgNode(h);if(g)g.setAttribute("x1","".concat(r[0])),g.setAttribute("y1","".concat(r[1])),g.setAttribute("x2","".concat(o[0])),g.setAttribute("y2","".concat(o[1])),g.setAttribute("stroke",c),g.setAttribute("stroke-width",v),u?g.setAttribute("stroke-dasharray",u):g.removeAttribute("stroke-dasharray"),e._setNodeTouched(h);else{var m=document.createElementNS(f,"line");m.setAttribute("x1","".concat(r[0])),m.setAttribute("y1","".concat(r[1])),m.setAttribute("x2","".concat(o[0])),m.setAttribute("y2","".concat(o[1])),m.setAttribute("stroke",c),m.setAttribute("stroke-width",v),u&&m.setAttribute("stroke-dasharray",u),e._appendNode(m,h)}}function Me(e,t,n,a,r,o,i){var l,c=i.padding,s=i.color,d=i.fontFamily,u=i.fontSize,v=i.background,f=o[0]+c,h=o[1]+c,g=Ue(t,n,"text",a),m=e._getSvgNode(g);if(m){m.setAttribute("transform","translate(".concat(f," ").concat(h,")"));for(var p=m.querySelector("text"),b=Array.from(p.children),w=0;w<b.length;w++){var E=b[w],y=r[w]||"";E.textContent=y}d?p.setAttribute("font-family",d):p.removeAttribute("font-family"),u?p.setAttribute("font-size",u):p.removeAttribute("font-size"),s?p.setAttribute("fill",s):p.removeAttribute("fill"),Oe(m,v),l=m.getBBox(),e._setNodeTouched(g)}else{var _=document.createElementNS("http://www.w3.org/2000/svg","g");_.setAttribute("transform","translate(".concat(f," ").concat(h,")"));for(var D=function(e){var t=e.color,n=e.fontFamily,a=e.fontSize,r=document.createElementNS("http://www.w3.org/2000/svg","text"),o="".concat("user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);").concat("filter:url(#shadow);");return r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("fill",t),r.setAttribute("font-family",n),r.setAttribute("font-size",a),r.setAttribute("style",o),r}(i),C=0;C<r.length;C++){var T=xe(r[C]);D.appendChild(T)}_.appendChild(D),e._appendNode(_,g),Oe(_,v),l=_.getBBox()}return Object.assign({},l,{x:f,y:h,height:l.height+c,width:l.width+c})}function xe(e){var t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttribute("x","0"),t.setAttribute("dy","1.2em"),t.textContent=e,t}function Oe(e,t){var n=e.querySelector("rect.background");if(t){n||((n=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("class","background"),e.insertBefore(n,e.firstChild));var a=e.getBBox();n.setAttribute("x","".concat(a.x)),n.setAttribute("y","".concat(a.y)),n.setAttribute("width","".concat(a.width)),n.setAttribute("height","".concat(a.height)),n.setAttribute("fill",t)}else n&&e.removeChild(n)}var Le=function(e,t,n,a,r,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},i),c=Me(e,t,n,a,r,o,l);return c};function Ae(e){var t=e.x,n=e.y,a=e.height,r=e.width,o=r/2,i=a/2;return[[t+o,n],[t,n+i],[t+o,n+a],[t+r,n+i]]}var Re=function(e,t,n,a,r,o,i){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=r.length>0?O(r,o):o,s=Ae(i),d=O(s,c),u=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},l);ke(e,t,n,"link-".concat(a),c,d,u)},Pe=function(e,t,n,a,r,o,i,l){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},s=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},c),d=Le(e,t,n,a,r,o,s);return Re(e,t,n,a,i,o,d,s),d};function Ne(e,t,n,a,r,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},i),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=d||s,f="http://www.w3.org/2000/svg",h=Ue(t,n,"rect",a),g=e._getSvgNode(h),m=[Math.min(r[0],o[0]),Math.min(r[1],o[1])],p=Math.abs(r[0]-o[0]),b=Math.abs(r[1]-o[1]);if(g)g.setAttribute("x","".concat(m[0])),g.setAttribute("y","".concat(m[1])),g.setAttribute("width","".concat(p)),g.setAttribute("height","".concat(b)),g.setAttribute("stroke",c),g.setAttribute("stroke-width",v),u?g.setAttribute("stroke-dasharray",u):g.removeAttribute("stroke-dasharray"),e._setNodeTouched(h);else{var w=document.createElementNS(f,"rect");w.setAttribute("x","".concat(m[0])),w.setAttribute("y","".concat(m[1])),w.setAttribute("width","".concat(p)),w.setAttribute("height","".concat(b)),w.setAttribute("fill","transparent"),w.setAttribute("stroke",c),w.setAttribute("stroke-width",v),u&&w.setAttribute("stroke-dasharray",u),e._appendNode(w,h)}}function Ve(e,t,n){for(var a=e.detail,r=a.renderingEngineUID,o=a.sceneUID,i=a.viewportUID,l=kt.getToolGroups(r,o,i),c=[],s=0;s<l.length;s++)for(var d=l[s],u=Object.keys(d.tools),v=0;v<u.length;v++){var f=u[v],h=d.tools[f];if(t.includes(h.mode)&&(!n||h.bindings.includes(n))){var g=d._tools[f];c.push(g)}}return c}var Be=w.Active,He=w.Passive,je=w.Enabled,We=function(e){var t=e.detail.canvas,n=Ve(e,[Be,He,je]);Te(t,(function(t){n.forEach((function(n){n.renderToolData&&n.renderToolData(e,t)}))}))},Fe=w.Active;function Ge(e,t,n){if(J.isToolLocked)return!1;for(var a,r=n.detail,o=r.renderingEngineUID,i=r.sceneUID,l=r.viewportUID,c=kt.getToolGroups(o,i,l),s=0;s<c.length;s++){for(var d=c[s],u=Object.keys(d.tools),v=0;v<u.length;v++){var f=u[v],h=d.tools[f],g=d._tools[f];if(h.mode===Fe&&"function"==typeof g[t]){a=d._tools[f];break}}if(a)break}a&&a[t](n)}var ze=Ge.bind(null,"Mouse","mouseClickCallback"),qe=Ge.bind(null,"Mouse","doubleClickCallback"),Ke=new Set;function Ye(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=et();t||tt(Ke,n),e&&(Ke.add(e),n.added.push(e)),nt(n,Ke)}function Xe(e){var t=et();e?Ke.delete(e)&&t.removed.push(e):tt(Ke,t),nt(t,Ke)}function $e(){return Array.from(Ke)}function Je(e){return $e().find((function(t){return t.metadata.toolUID===e}))}function Ze(e){return Ke.has(e)}function Qe(){return Ke.size}function et(){return Object.freeze({added:[],removed:[],selection:[]})}function tt(e,t){e.forEach((function(n){e.delete(n)&&t.removed.push(n)}))}function nt(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach((function(t){e.selection.push(t)})),(0,f.triggerEvent)(f.eventTarget,_.MEASUREMENT_SELECTION_CHANGE,e))}function at(e,t){for(var n=[],a=0;a<t.length;a++){var r=t[a];if(r){var o=ln((0,f.getEnabledElement)(e),r.name);o&&("function"==typeof r.filterInteractableToolStateForElement&&(o=r.filterInteractableToolStateForElement(e,o)),o.length>0&&n.push({tool:r,toolState:o}))}else console.warn("undefined tool in getToolsWithDataForElement")}return n}var rt=w.Active;function ot(e){for(var t=e.detail,n=t.renderingEngineUID,a=t.sceneUID,r=t.viewportUID,o=e.detail.event,i=kt.getToolGroups(n,a,r),l=0;l<i.length;l++)for(var c=i[l],s=Object.keys(c.tools),d=0;d<s.length;d++){var u=s[d],v=c.tools[u];if(v.mode===rt&&v.bindings.includes(o.buttons))return c._tools[u]}}var it=w.Active,lt=w.Passive;function ct(e){if(!J.isToolLocked){var t=ot(e);if(t&&"function"==typeof t.preMouseDownCallback&&t.preMouseDownCallback(e))return;var n=1===e.detail.event.buttons,a=Ve(e,[it],e.detail.event.buttons),r=n?Ve(e,[lt]):void 0,o=[].concat(x(a||[]),x(r||[])),i=e.detail,l=i.element,c=at(l,o),s=i.currentPoints.canvas,d=function(e,t,n){if(0===t.length)return[];var a=[];return t.forEach((function(t){for(var r=t.tool,o=t.toolState,i=0;i<o.length;i++){var l=r.getHandleNearImagePoint(e,o[i],n,6);if(l){a.push({tool:r,toolData:o[i],handle:l});break}}})),a}(l,c,s),u=!!e.detail.event.shiftKey;if(d.length>0){var v=d[0],f=v.tool,h=v.toolData,g=v.handle;return st(h,u),void f.handleSelectedCallback(e,h,g,"mouse")}var m=function(e,t,n){if(0===t.length)return[];var a=[];return t.forEach((function(t){for(var r=t.tool,o=t.toolState,i=0;i<o.length;i++)if(r.pointNearTool(e,o[i],n,6)){a.push({tool:r,toolData:o[i]});break}})),a}(l,c,s);if(m.length>0){var p=m[0],b=p.tool,w=p.toolData;return st(w,u),void b.toolSelectedCallback(e,w,"mouse")}if(t&&"function"==typeof t.postMouseDownCallback&&t.postMouseDownCallback(e))return}}function st(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?Ze(e)?Xe(e):Ye(e,!0):Ye(e,!1)}function dt(e){if(!J.isToolLocked){var t=ot(e);t&&(J.isMultiPartToolActive||t.addNewMeasurement&&Ye(t.addNewMeasurement(e,"mouse")))}}function ut(e){if(!J.isToolLocked){var t=ot(e);!t||"function"!=typeof t.mouseDragCallback||t.mouseDragCallback(e)}}var vt=w.Active,ft=w.Passive;function ht(e){if(!J.isToolLocked&&!J.isMultiPartToolActive){for(var t=Ve(e,[vt,ft]),n=e.detail.element,a=at(n,t),r=a.length,o=!1,i=0;i<r;i++){var l=a[i],c=l.tool,s=l.toolState;"function"==typeof c.mouseMoveCallback&&(o=c.mouseMoveCallback(e,s)||o)}!0===o&&(0,f.getEnabledElement)(n).viewport.render()}}var gt=Ge.bind(null,"Mouse","mouseUpCallback"),mt=Ge.bind(null,"MouseWheel","mouseWheelCallback"),pt=function(e){e.addEventListener(_.MOUSE_CLICK,ze),e.addEventListener(_.MOUSE_DOWN,ct),e.addEventListener(_.MOUSE_DOWN_ACTIVATE,dt),e.addEventListener(_.MOUSE_DOUBLE_CLICK,qe),e.addEventListener(_.MOUSE_DRAG,ut),e.addEventListener(_.MOUSE_MOVE,ht),e.addEventListener(_.MOUSE_UP,gt),e.addEventListener(_.MOUSE_WHEEL,mt)},bt=function(e){e.removeEventListener(_.MOUSE_CLICK,ze),e.removeEventListener(_.MOUSE_DOWN,ct),e.removeEventListener(_.MOUSE_DOWN_ACTIVATE,dt),e.removeEventListener(_.MOUSE_DOUBLE_CLICK,qe),e.removeEventListener(_.MOUSE_DRAG,ut),e.removeEventListener(_.MOUSE_MOVE,ht),e.removeEventListener(_.MOUSE_UP,gt),e.removeEventListener(_.MOUSE_WHEEL,mt)},wt=w.Active,Et=w.Passive,yt=w.Enabled,_t=function(e){Ve(e,[wt,Et,yt]).forEach((function(t){t.onCameraModified&&t.onCameraModified(e)}))};function Dt(e){var t,n,a=e.detail.canvas,r=function(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.classList.add("svg-layer"),t.setAttribute("id","svg-layer"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t.style.position="absolute";var n=document.createElementNS(e,"defs"),a=document.createElementNS(e,"filter"),r=document.createElementNS(e,"feOffset"),o=document.createElementNS(e,"feColorMatrix"),i=document.createElementNS(e,"feGaussianBlur"),l=document.createElementNS(e,"feBlend");return a.setAttribute("id","shadow"),a.setAttribute("width","110%"),a.setAttribute("height","110%"),r.setAttribute("result","offOut"),r.setAttribute("in","SourceGraphic"),r.setAttribute("dx","0.5"),r.setAttribute("dy","0.5"),o.setAttribute("result","matrixOut"),o.setAttribute("in","offOut"),o.setAttribute("type","matrix"),o.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),i.setAttribute("result","blurOut"),i.setAttribute("in","matrixOut"),i.setAttribute("stdDeviation","0.25"),l.setAttribute("in","SourceGraphic"),l.setAttribute("in2","blurOut"),l.setAttribute("mode","normal"),a.appendChild(r),a.appendChild(o),a.appendChild(i),a.appendChild(l),n.appendChild(a),t.appendChild(n),t}();!function(e){var t=e.dataset,n=t.viewportUid,a=t.sceneUid,r=t.renderingEngineUid,o="".concat(n,":").concat(a,":").concat(r);J.svgNodeCache[o]={}}(a),t=r,(n=a).parentNode.insertBefore(t,n.nextSibling),pe.enable(a),Ee.enable(a),a.addEventListener(f.EVENTS.IMAGE_RENDERED,We),function(e){e.addEventListener(f.EVENTS.CAMERA_MODIFIED,_t)}(a),pt(a),J.enabledElements.push(a)}var Ct=function(e){var t,n,a=e.detail.canvas;pe.disable(a),Ee.disable(a),a.removeEventListener(f.EVENTS.IMAGE_RENDERED,We),function(e){e.removeEventListener(f.EVENTS.CAMERA_MODIFIED,_t)}(a),bt(a),t=a,(n=J.enabledElements.findIndex((function(e){return e===t})))>-1&&J.enabledElements.splice(n,1)},Tt=w.Active,Ut=w.Passive,St=w.Enabled,It=w.Disabled,kt={createToolGroup:function(e){if(!J.toolGroups.some((function(t){return t.id===e}))){var t={_tools:{},id:e,viewports:[],tools:{},getToolInstance:function(e){var t=this._tools[e];if(t)return t;console.warn("'".concat(e,"' is not registered with this toolGroup."))},addTool:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=J.tools[e],a=void 0!==e&&""!==e,r=this.tools[e];if(a)if(n)if(r)console.warn("'".concat(e,"' is already registered for this ToolGroup."));else{var o=n.toolClass,i=n.toolOptions,l=Object.assign({},i,t),c=new o(l);this._tools[e]=c}else console.warn("'".concat(e,"' is not registered with the library."));else console.warn("Tool with configuration did not produce a toolName: ",t)},addViewports:function(e,t,n){this.viewports.push({renderingEngineUID:e,sceneUID:t,viewportUID:n})},setToolActive:function(e,t){if(void 0!==this._tools[e]){var n=Object.assign({bindings:[]},t,{mode:Tt});this.tools[e]=n,this._tools[e].mode=Tt,this.refreshViewports()}else console.warn("Tool ".concat(e," not added to toolgroup, can't set tool mode."))},setToolPassive:function(e,t){if(void 0!==this._tools[e]){var n=Object.assign({bindings:[]},t,{mode:Ut});this.tools[e]=n,this._tools[e].mode=Ut,this.refreshViewports()}else console.warn("Tool ".concat(e," not added to toolgroup, can't set tool mode."))},setToolEnabled:function(e,t){if(void 0!==this._tools[e]){var n=Object.assign({bindings:[]},t,{mode:St});this.tools[e]=n,this._tools[e].mode=St,this.refreshViewports()}else console.warn("Tool ".concat(e," not added to toolgroup, can't set tool mode."))},setToolDisabled:function(e,t){if(void 0!==this._tools[e]){var n=Object.assign({bindings:[]},t,{mode:It});this.tools[e]=n,this._tools[e].mode=It,this.refreshViewports()}else console.warn("Tool ".concat(e," not added to toolgroup, can't set tool mode."))},refreshViewports:function(){this.viewports.forEach((function(e){var t=e.renderingEngineUID,n=e.viewportUID;(0,f.getRenderingEngine)(t).renderViewport(n)}))}};return J.toolGroups.push(t),t}console.warn("'".concat(e,"' already exists."))},destroy:function(){J.toolGroups=[]},destroyToolGroupById:function(e){var t=J.toolGroups.findIndex((function(t){return t.id===e}));t>-1&&J.toolGroups.splice(t,1)},getToolGroupById:function(e){return J.toolGroups.find((function(t){return t.id===e}))},getToolGroups:function(e,t,n){return J.toolGroups.filter((function(a){return a.viewports.some((function(a){return!(a.renderingEngineUID!==e||a.viewportUID&&a.viewportUID!==n||a.sceneUID&&a.sceneUID!==t)}))}))}};function Mt(e,t){return e.findIndex((function(e){return t.renderingEngineUID===e.renderingEngineUID&&t.sceneUID===e.sceneUID&&t.viewportUID===e.viewportUID}))}var xt=function(){function e(t,a,r){n(this,e),o(this,"_enabled",void 0),o(this,"_eventName",void 0),o(this,"_eventHandler",void 0),o(this,"_ignoreFiredEvents",void 0),o(this,"_sourceViewports",void 0),o(this,"_targetViewports",void 0),o(this,"id",void 0),this._enabled=!0,this._eventName=a,this._eventHandler=r,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this.id=t}return r(e,[{key:"isDisabled",value:function(){return!this._enabled||!this._hasSourceElements()}},{key:"add",value:function(e){this.addTarget(e),this.addSource(e)}},{key:"addSource",value:function(e){var t=e.renderingEngineUID,n=e.sceneUID,a=e.viewportUID;(0,f.getRenderingEngine)(t).getScene(n).getViewport(a).getCanvas().addEventListener(this._eventName,this._onEvent.bind(this)),this._updateDisableHandlers(),this._sourceViewports.push(e)}},{key:"addTarget",value:function(e){this._targetViewports.push(e),this._updateDisableHandlers()}},{key:"destroy",value:function(){var e=this;this._sourceViewports.forEach((function(t){return e.removeSource(t)})),this._targetViewports.forEach((function(t){return e.removeTarget(t)}))}},{key:"remove",value:function(e){this.removeTarget(e),this.removeSource(e)}},{key:"removeSource",value:function(e){var t=Mt(this._sourceViewports,e);if(-1!==t){var n,a=(n=e,(0,f.getRenderingEngine)(n.renderingEngineUID).getScene(n.sceneUID).getViewport(n.viewportUID).getCanvas());this._sourceViewports.splice(t,1),a.removeEventListener(this._eventName,this._eventHandler),this._updateDisableHandlers()}}},{key:"removeTarget",value:function(e){var t=Mt(this._sourceViewports,e);-1!==t&&(this._targetViewports.splice(t,1),this._updateDisableHandlers())}},{key:"hasSourceViewport",value:function(e,t,n){return this._sourceViewports.some((function(a){return a.renderingEngineUID===e&&a.sceneUID===t&&a.viewportUID===n}))}},{key:"fireEvent",value:function(e,t){if(!this.isDisabled()&&!this._ignoreFiredEvents){this._ignoreFiredEvents=!0;try{for(var n=0;n<this._targetViewports.length;n++){var a=this._targetViewports[n];e.viewportUID===a.viewportUID||this._eventHandler(this,e,a,t)}}catch(e){console.warn("Synchronizer, for: ".concat(this._eventName),e)}finally{this._ignoreFiredEvents=!1}}}},{key:"_onEvent",value:function(e){if(!0!==this._ignoreFiredEvents){var t=(0,f.getEnabledElement)(e.currentTarget),n=t.renderingEngineUID,a=t.sceneUID,r=t.viewportUID;this.fireEvent({renderingEngineUID:n,sceneUID:a,viewportUID:r},e)}}},{key:"_hasSourceElements",value:function(){return 0!==this._sourceViewports.length}},{key:"_updateDisableHandlers",value:function(){var e=function(e,t){for(var n=[],a=e.concat(t),r=function(e){var t=a[e];n.some((function(e){return t.renderingEngineUID===e.renderingEngineUID&&t.sceneUID===e.sceneUID&&t.viewportUID===e.viewportUID}))||n.push(t)},o=0;o<a.length;o++)r(o);return n}(this._sourceViewports,this._targetViewports),t=this.remove,n=function(e){t(e.detail.element)};e.forEach((function(e){var t=(0,f.getRenderingEngine)(e.renderingEngineUID).getScene(e.sceneUID).getViewport(e.viewportUID).getCanvas();t.removeEventListener(f.EVENTS.ELEMENT_DISABLED,n),t.addEventListener(f.EVENTS.ELEMENT_DISABLED,n)}))}}]),e}(),Ot={createSynchronizer:function(e,t,n){if(!J.synchronizers.some((function(t){return t.id===e}))){var a=new xt(e,t,n);return J.synchronizers.push(a),a}console.warn("'".concat(e,"' already exists."))},destroy:function(){for(;J.synchronizers.length>0;)J.synchronizers.pop().destroy()},getSynchronizerById:function(e){return J.synchronizers.find((function(t){return t.id===e}))},getSynchronizers:function(e,t,n){var a=[];if(!e&&!t&&!n)throw new Error("At least one of renderingEngineUID or sceneUID or viewportUID should be given");for(var r=0;r<J.synchronizers.length;r++){var o=J.synchronizers[r],i=!o.isDisabled(),l=o.hasSourceViewport(e,t,n);i&&l&&a.push(o)}return a},getAllSynchronizers:function(){return J.synchronizers}};function Lt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,a=(0,f.getEnabledElement)(e);return a?At(a,t,n):null}function At(e,t,n){for(var a=e.renderingEngineUID,r=e.sceneUID,o=e.viewportUID,i=kt.getToolGroups(a,r,o),l=0;l<i.length;++l){var c=i[l]._tools;for(var s in c)if(Object.prototype.hasOwnProperty.call(c,s)){var d=Rt(c[s],e,t,n);if(d)return d}}return null}function Rt(e,t,n,a){var r=ln(t,e.name);if(Array.isArray(r)&&r.length>0)for(var o=t.viewport.canvas,i=0;i<r.length;++i){var l=r[i];if(e.pointNearTool(o,l,n,a,"")||e.getHandleNearImagePoint(o,l,n,a))return l}return null}var Pt=w.Active,Nt=w.Passive,Vt=w.Enabled;function Bt(e,t){var n=e.tools[t];if(!n)return!1;var a=n.mode;return a===Pt||a===Nt||a===Vt}function Ht(e,t){var n=(0,f.getEnabledElement)(e),a=n.renderingEngine,r=n.FrameOfReferenceUID,o=a.getViewports();return(o=function(e,t){for(var n=e.length,a=[],r=0;r<n;r++){var o=e[r];kt.getToolGroups(o.renderingEngineUID,o.sceneUID,o.uid).some((function(e){return Bt(e,t)}))&&a.push(o)}return a}(o=function(e,t){for(var n=e.length,a=[],r=0;r<n;r++){var o=e[r];o.getFrameOfReferenceUID()===t&&a.push(o)}return a}(o,r),t)).map((function(e){return e.uid}))}function jt(e,t){return!(e[0]<0||e[0]>=t[0]||e[1]<0||e[1]>=t[1]||e[2]<0||e[2]>=t[2])}function Wt(e){var t,n,a,r,o=(n=[(t=e)[0],t[1]].sort((function(e,t){return e[0]<t[0]?-1:1})),a=[t[0],t[1]].sort((function(e,t){return e[1]<t[1]?-1:1})),r=n[n.length-1],{top:a[0],bottom:a[a.length-1],right:r}),i=(o.top[1]+o.bottom[1])/2;return[o.right[0],i]}function Ft(e,t,n,a,r,o){var i=n.min,l=n.max,c=n.current,s=F.vec3.create();F.vec3.sub(s,t,e);var d=Math.round((l-i)/r),u=(c-i)/(l-i)*d,v=Math.round(u),f=[e[0]-a[0]*u*r,e[1]-a[1]*u*r,e[2]-a[2]*u*r];(v+=o)>d?v=d:v<0&&(v=0);var h=v*r;return{newFocalPoint:f=[f[0]+a[0]*h,f[1]+a[1]*h,f[2]+a[2]*h],newPosition:[f[0]+s[0],f[1]+s[1],f[2]+s[2]]}}var Gt=l(653),zt=l.n(Gt);function qt(e,t,n){var a=function(e){var t=e.getMapper().getBounds();return[[t[0],t[2],t[4]],[t[0],t[2],t[5]],[t[0],t[3],t[4]],[t[0],t[3],t[5]],[t[1],t[2],t[4]],[t[1],t[2],t[5]],[t[1],t[3],t[4]],[t[1],t[3],t[5]]]}(e),r=zt().buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);a.forEach((function(e){return r.apply(e)}));var o=x(n);r.apply(o);for(var i=o[0],l=1/0,c=-1/0,s=0;s<8;s++){var d=a[s][0];d>c&&(c=d),d<l&&(l=d)}return{min:l,max:c,current:i}}var Kt=function(e,t,n){return Math.min(Math.max(t,e),n)};function Yt(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.detail,o=r.element,i=r.wheel,l=(0,f.getEnabledElement)(o),c=l.scene,s=l.viewport,d=s.type,u=s.getCamera(),v=u.focalPoint,h=u.viewPlaneNormal,g=u.position;if(s instanceof f.StackViewport){var m=s.getCurrentImageIdIndex(),p=s.getImageIds().length,b=i.direction,w=a?-b:b,E=m+w;E=Kt(E,0,p-1),s.setImageIdIndex(E)}else{if(!(s instanceof f.VolumeViewport))throw new Error("Not implemented for Viewport Type: ".concat(d));var y=z(c,u,n),_=y.spacingInNormalDirection,D=y.imageVolume;if(!D)return;var C=c.getVolumeActor(D.uid),T=qt(C,h,v),U=Ft(v,g,T,h,_,t),S=U.newFocalPoint,I=U.newPosition;s.setCamera({focalPoint:S,position:I}),s.render()}}function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var $t=function(e){var t=Xt(e);return null!==e&&("object"===t||"function"===t)},Jt=function(e){return e&&"object"===Xt(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},Zt=function(e,t){var n;return t&&!0===t.clone&&Jt(e)?tn((n=e,Array.isArray(n)?[]:{}),e,t):e},Qt=function(e,t,n){var a=e.slice();return t.forEach((function(t,r){void 0===a[r]?a[r]=Zt(t,n):Jt(t)?a[r]=tn(e[r],t,n):-1===e.indexOf(t)&&a.push(Zt(t,n))})),a},en=function(e,t,n){var a={};return Jt(e)&&Object.keys(e).forEach((function(t){a[t]=Zt(e[t],n)})),Object.keys(t).forEach((function(r){Jt(t[r])&&e[r]?a[r]=tn(e[r],t[r],n):a[r]=Zt(t[r],n)})),a},tn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=Array.isArray(t),r=n||{arrayMerge:Qt},o=r.arrayMerge||Qt;return a?Array.isArray(e)?o(e,t,n):Zt(t,n):en(e,t,n)},nn=tn,an=function(e,t,n){var a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return $t(n)&&(a="leading"in n?Boolean(n.leading):a,r="trailing"in n?Boolean(n.trailing):r),function(e,t,n){var a,r,o,i,l,c,s=0,d=!1,u=!1,v=!0,f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=a,o=r;return a=r=void 0,s=t,i=e.apply(o,n)}function g(e,t){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function m(e){return s=e,l=g(b,t),d?h(e):i}function p(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-s>=o}function b(){var e=Date.now();if(p(e))return w(e);l=g(b,function(e){var n=e-s,a=t-(e-c);return u?Math.min(a,o-n):a}(e))}function w(e){return l=void 0,v&&a?h(e):(a=r=void 0,i)}function E(){for(var e=Date.now(),n=p(e),o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];if(a=s,r=this,c=e,n){if(void 0===l)return m(c);if(u)return l=g(b,t),h(c)}return void 0===l&&(l=g(b,t)),i}return t=Number(t)||0,$t(n)&&(d=Boolean(n.leading),o=(u="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):o,v="trailing"in n?Boolean(n.trailing):v),E.cancel=function(){void 0!==l&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),s=0,a=c=r=l=void 0},E.flush=function(){return void 0===l?i:w(Date.now())},E.pending=function(){return void 0!==l},E}(e,t,{leading:a,trailing:r,maxWait:t})};function rn(e,t){return void 0===e?t:e}function on(e){return g}function ln(e,t){var n=on(),a=e.FrameOfReferenceUID;return n.get(a,t)}function cn(e,t){var n=on();void 0===t.metadata.toolUID&&(t.metadata.toolUID=i()),n.addToolState(t)}function sn(e,t){if(e){var n=J.tools[e];if(n){var a=n.toolClass;return t?f.Settings.getObjectSettings(t,a):f.Settings.getObjectSettings(a)}}return f.Settings.getRuntimeSettings()}function dn(e){return f.Settings.getRuntimeSettings().set("tool.style",e)}function un(e,t){var n=J.tools[e];if(n){var a=n.toolClass;return f.Settings.getObjectSettings(a).set("tool.style",t)}return!1}function vn(e,t,n){var a=J.tools[e];if(a){var r=a.toolClass;return f.Settings.getObjectSettings(t,r).set("tool.style",n)}return!1}function fn(){!function(){!function(){var e=f.EVENTS.ELEMENT_ENABLED,t=f.EVENTS.ELEMENT_DISABLED;f.eventTarget.removeEventListener(e,Dt),f.eventTarget.removeEventListener(t,Ct)}();var e=f.EVENTS.ELEMENT_ENABLED,t=f.EVENTS.ELEMENT_DISABLED;f.eventTarget.addEventListener(e,Dt),f.eventTarget.addEventListener(t,Ct)}()}function hn(e,t){e.save(),t(e),e.restore()}function gn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=t.color,r=t.lineWidth,o=t.fillStyle,i=t.lineDash,l=t.shouldDrawLines,c=void 0===l||l;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=r||void 0===r&&parseInt(U("lineWidth"),10)||e.lineWidth,i&&e.setLineDash(i),n(e),o&&(e.fillStyle=o,e.fill()),c&&e.stroke(),i&&e.setLineDash([])}function mn(e,t,n,a){gn(e,a,(function(e){e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1])}))}function pn(e,t,n,a){gn(e,a,(function(e){e.moveTo(t[0],t[1]),n.forEach((function(t){e.lineTo(t[0],t[1])}))}))}f.triggerEvent;var bn=R.findClosestPoint;function wn(e,t,n,a,r,o){var i=e.length>0?bn(e,t):t,l=[[n.left+n.width/2,n.top],[n.left,n.top+n.height/2],[n.left+n.width/2,n.top+n.height],[n.left+n.width,n.top+n.height/2]];mn(a,i,bn(l,i),{color:r,lineWidth:o,lineDash:[2,3]})}function En(e,t,n,a,r){var o=parseInt(U("textBox.fontSize"),10)||14;e.font=S(),e.textBaseline="top",e.fillStyle=a,n.forEach((function(n,a){e.fillText(n,t.left+r,t.top+r+a*(o+r))}))}function yn(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)}function _n(e,t,n){var a=S(),r=e.font;a&&a!==r&&(e.font=a);var o=e.measureText(t).width;return a&&a!==r&&(e.font=r),o+2*n}function Dn(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=5,l=parseInt(U("textBox.fontSize"),10)||14,c=U("textBox.background"),s=0;t.forEach((function(t){var n=_n(e,t,i);s=Math.max(s,n)}));var d={width:s,height:i+t.length*(l+i)};return hn(e,(function(e){e.strokeStyle=r,o&&o.centering&&!0===o.centering.x&&(n-=d.width/2),o&&o.centering&&!0===o.centering.y&&(a-=d.height/2),d.left=n,d.top=a;var l=o&&!0===o.debug?"#FF0000":c;yn(e,d,l),En(e,d,t,r,i)})),d}var Cn={draw:hn,drawArrow:function(e,t,n,a,r){var o=Math.atan2(n[1]-t[1],n[0]-t[0]);mn(e,void 0,t,n),pn(e,void 0,n,[[n[0]-10*Math.cos(o-Math.PI/7),n[1]-10*Math.sin(o-Math.PI/7)],[n[0]-10*Math.cos(o+Math.PI/7),n[1]-10*Math.sin(o+Math.PI/7)],n])},drawCircle:function(e,t,n,a){gn(e,a,(function(e){e.arc(t[0],t[1],n,0,2*Math.PI)}))},drawEllipse:function(e,t,n,a){var r=Math.abs(t[0]-n[0]),o=Math.abs(t[1]-n[1]),i=Math.min(t[0],n[0]),l=Math.min(t[1],n[1]),c=[i+r/2,l+o/2];gn(e,a,(function(e){e.ellipse(c[0],c[1],r/2,o/2,0,0,2*Math.PI),e.closePath()}))},drawHandles:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=U("color");e.strokeStyle=n.color||a;for(var r=Object.keys(t),o=function(a){var o=r[a],i=t[o];if(!0===i.drawnIndependently)return"continue";if(!0===n.drawHandlesIfActive&&!i.active)return"continue";var l=parseInt(U("lineWidth",i.active?"Highlighted":""),10),c=n.fill;gn(e,{lineWidth:l,fillStyle:c},(function(e){var t=i.radius||n.handleRadius||J.handleRadius;e.arc(i[0],i[1],t,0,2*Math.PI)}))},i=0;i<r.length;i++)o(i)},drawJoinedLines:pn,drawLine:mn,drawLines:function(e,t,n){gn(e,n,(function(e){t.forEach((function(t){var n=t.start,a=t.end;e.moveTo(n[0],n[1]),e.lineTo(a[0],a[1])}))}))},drawLink:wn,drawLinkedTextBox:function(e,t,n,a,r,o,i,l,c,s){c&&(t[0]+=c);var d={centering:{x:!1,y:s}},u=Dn(e,n,t[0],t[1],i,d);a.hasMoved&&wn(r,t,u,e,i,l);var v=u.top,f=u.left,h=u.width,g=u.height;a.worldBoundingBox={topLeft:o([f,v]),topRight:o([f+h,v]),bottomLeft:o([f,v+g]),bottomRight:o([f+h,v+g])}},drawRect:function(e,t,n,a){var r=Math.abs(t[0]-n[0]),o=Math.abs(t[1]-n[1]),i=[Math.min(t[0],n[0]),Math.min(t[1],n[1])],l=[i[0]+r,i[1]+o],c=[i[0]+r,i[1]],s=[i[0],i[1]+o];gn(e,a,(function(e){e.moveTo(i[0],i[1]),e.lineTo(c[0],c[1]),e.moveTo(c[0],c[1]),e.lineTo(l[0],l[1]),e.moveTo(l[0],l[1]),e.lineTo(s[0],s[1]),e.moveTo(s[0],s[1]),e.lineTo(i[0],i[1])}))},drawTextBox:Dn,fillBox:yn,fillOutsideRect:function(e,t,n,a){var r=Math.min(t[0],n[0]),o=Math.min(t[1],n[1]),i=Math.abs(t[0]-n[0]),l=Math.abs(t[1]-n[1]);gn(e,a,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(r+i,o,-i,l)}))},fillTextLines:En,getNewContext:function(e){return e.getContext("2d")},path:gn,setShadow:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=rn(t.shadowColor,"#000000"),e.shadowBlur=rn(t.shadowBlur,0),e.shadowOffsetX=rn(t.shadowOffsetX,1),e.shadowOffsetY=rn(t.shadowOffsetY,1))}};function Tn(e,t,n,a){if(t.renderingEngineUID!==n.renderingEngineUID||t.sceneUID!==n.sceneUID||t.viewportUID!==n.viewportUID){var r=a.detail.camera,o=(0,f.getRenderingEngine)(n.renderingEngineUID).getScene(n.sceneUID).getViewport(n.viewportUID);o.setCamera(r),o.render()}}var Un=f.EVENTS.CAMERA_MODIFIED;function Sn(e,t,n,a){var r=a.detail,o=r.volumeUID,i=r.sceneUID,l=r.range,c=(0,f.getRenderingEngine)(n.renderingEngineUID);if(!c)throw new Error("Rendering Engine does not exist: ".concat(n.renderingEngineUID));var s=c.getScene(n.sceneUID);if(s.uid!==i){var d=s.getViewport(n.viewportUID);s.getVolumeActor(o).getProperty().getRGBTransferFunction(0).setRange(l.lower,l.upper),d.render()}}var In=f.EVENTS.VOI_MODIFIED,kn={createCameraPositionSynchronizer:function(e){return Ot.createSynchronizer(e,Un,Tn)},createVOISynchronizer:function(e){return Ot.createSynchronizer(e,In,Sn)}},Mn=function(){function e(t,a){n(this,e),o(this,"initialConfiguration",void 0),o(this,"name",void 0),o(this,"supportedInteractionTypes",void 0),o(this,"strategies",void 0),o(this,"defaultStrategy",void 0),o(this,"activeStrategy",void 0),o(this,"configuration",void 0),o(this,"mode",void 0),this.initialConfiguration=nn(t,a);var r=this.initialConfiguration,i=r.name,l=r.strategies,c=r.defaultStrategy,s=r.configuration,d=void 0===s?{}:s,u=r.supportedInteractionTypes;this.name=i,this.supportedInteractionTypes=u||[],this.strategies=l||{},this.defaultStrategy=c||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,this.configuration=Object.assign({},d),this.mode=w.Disabled}return r(e,[{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"setActiveStrategyName",value:function(e){this.activeStrategy=e}}]),e}();function xn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function On(e,t){return(On=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ln(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&On(e,t)}function An(e,t){return!t||"object"!==Xt(t)&&"function"!=typeof t?xn(e):t}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e;n(this,l);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return o(xn(e=i.call.apply(i,[this].concat(a))),"mouseMoveCallback",(function(t,n){for(var a=t.detail,r=a.element,o=a.currentPoints.canvas,i=!1,l=0;l<n.length;l++){var c=n[l],s=c.data,d=s.handles?s.handles.activeHandleIndex:void 0,u=e._imagePointNearToolOrHandle(r,c,o,6),v=u&&!s.active,f=!u&&s.active;v||f?(s.active=!s.active,i=!0):s.handles&&s.handles.activeHandleIndex!==d&&(i=!0)}return i})),e}return r(l,[{key:"_imagePointNearToolOrHandle",value:function(e,t,n,a){return!!this.getHandleNearImagePoint(e,t,n,a)||this.pointNearTool(e,t,n,a,"mouse")}},{key:"getStyle",value:function(e,t,n){return T(e,t,function(e){if(e){if(e.data&&e.data.active)return y.Highlighted;if(Ze(e))return y.Selected}return y.Default}(n),this.mode)}},{key:"getLinkedTextBoxStyle",value:function(e,t){return{fontFamily:this.getStyle(e,"textBox.fontFamily",t),fontSize:this.getStyle(e,"textBox.fontSize",t),color:this.getStyle(e,"textBox.color",t),background:this.getStyle(e,"textBox.background",t),lineWidth:this.getStyle(e,"textBox.link.lineWidth",t),lineDash:this.getStyle(e,"textBox.link.lineDash",t)}}}]),l}(Mn);var Nn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"Pan",supportedInteractionTypes:["Mouse","Touch"]})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),e.touchDragCallback=e._dragCallback.bind(xn(e)),e.mouseDragCallback=e._dragCallback.bind(xn(e)),e}return r(l,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.deltaPoints,r=(0,f.getEnabledElement)(n),o=a.world,i=r.viewport.getCamera(),l=i.focalPoint,c=i.position,s=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],d=[l[0]-o[0],l[1]-o[1],l[2]-o[2]];r.viewport.setCamera({focalPoint:d,position:s}),r.viewport.render()}}]),l}(Mn),Vn=l(708);var Bn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"WindowLevel",supportedInteractionTypes:["Mouse","Touch"]})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_getImageDynamicRange",(function(e){var t=(0,f.getVolume)(e),n=t.dimensions,a=t.scalarData,r=Math.floor(n[2]/2);if(t instanceof Vn.StreamingImageVolume){if(!t.loadStatus.cachedFrames[r])return Hn;var o,i,l=n[0]*n[1];a instanceof Float32Array?(o=4,i=Float32Array):a instanceof Uint8Array&&(o=1,i=Uint8Array);for(var c=new i(a.buffer,r*l*o,l),s=1/0,d=-1/0,u=0;u<l;u++){var v=c[u];v<s&&(s=v),v>d&&(d=v)}return d-s}})),e.touchDragCallback=e._dragCallback.bind(xn(e)),e.mouseDragCallback=e._dragCallback.bind(xn(e)),e}return r(l,[{key:"_toWindowLevel",value:function(e,t){var n=Math.abs(e-t);return{windowWidth:n,windowCenter:e+n/2}}},{key:"_toLowHighRange",value:function(e,t){return{lower:t-e/2,upper:t+e/2}}},{key:"_dragCallback",value:function(e){var t,n=e.detail,a=n.element,r=n.deltaPoints,o=(0,f.getEnabledElement)(a),i=o.scene,l=o.sceneUID,c=o.viewport,s=c.getDefaultActor().uid;if(c instanceof f.VolumeViewport&&s)t=i.getVolumeActor(s);else{var d=c.getActors();d&&d.length&&(t=d[0].volumeActor)}if(t){var u=t.getProperty().getRGBTransferFunction(0),v=r.canvas,h=4;if(c instanceof f.VolumeViewport&&s){var g=this._getImageDynamicRange(s);h=Math.round(g/1024)}var m=v[0]*h,p=v[1]*h,b=M(u.getRange(),2),w=b[0],E=b[1],y=this._toWindowLevel(w,E),_=y.windowWidth,D=y.windowCenter;_+=m,D+=p,_=Math.max(_,1);var C=this._toLowHighRange(_,D);u.setMappingRange(C.lower,C.upper);var T={volumeUID:s,sceneUID:l,range:C};(0,f.triggerEvent)(a,f.EVENTS.VOI_MODIFIED,T),i||c instanceof f.VolumeViewport?i.render():(c.setStackActorVOI(C),c.render())}}}]),l}(Mn),Hn=1024;var jn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"PetThreshold",supportedInteractionTypes:["Mouse","Touch"]})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_configuration",void 0),e.touchDragCallback=e._dragCallback.bind(xn(e)),e.mouseDragCallback=e._dragCallback.bind(xn(e)),e}return r(l,[{key:"_dragCallback",value:function(e){var t,n=e.detail,a=n.element,r=n.deltaPoints,o=(0,f.getEnabledElement)(a),i=o.scene,l=o.sceneUID,c=o.viewport.getDefaultActor().uid;if(c){if(!(t=i.getVolumeActor(c)))throw new Error("Scene does not have a volume actor with specified volumeUID: ".concat(c))}else{var s=i.getVolumeActors();s&&s.length&&(t=s[0].volumeActor)}if(t){var d=t.getProperty().getRGBTransferFunction(0),u=r.canvas[1]*(5/a.clientHeight),v=d.getRange(),h=v[0],g=v[1];g-=u,g=Math.max(g,.1),d.setMappingRange(h,g);var m={volumeUID:c,sceneUID:l,range:{lower:h,upper:g}};(0,f.triggerEvent)(a,f.EVENTS.VOI_MODIFIED,m),i.render()}}}]),l}(Mn);var Wn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"StackScroll",invert:!1,supportedInteractionTypes:["Mouse","Touch"]})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_configuration",void 0),e.touchDragCallback=e._dragCallback.bind(xn(e)),e.mouseDragCallback=e._dragCallback.bind(xn(e)),e}return r(l,[{key:"_dragCallback",value:function(e){var t=e.detail.deltaPoints.canvas[1],n=this.configuration;Yt(e,t,n.volumeUID,n.invert)}}]),l}(Mn);var Fn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"StackScrollMouseWheel",supportedInteractionTypes:["Mouse","Touch"]})),"_configuration",void 0),e}return r(l,[{key:"mouseWheelCallback",value:function(e){Yt(e,e.detail.wheel.direction,this.configuration.volumeUID)}}]),l}(Mn);var Gn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"Zoom",supportedInteractionTypes:["Mouse","Touch"]})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_dragParallelProjection",(function(e,t){var n=e.detail,a=n.element,r=n.deltaPoints,o=(0,f.getEnabledElement)(a).viewport,i=1.5/(a.clientWidth,a.clientHeight),l=r.canvas[1]*i;o.setCamera({parallelScale:(1-l)*t.parallelScale})})),o(xn(e),"_dragPerspectiveProjection",(function(e,t){var n=e.detail,a=n.element,r=n.deltaPoints,o=(0,f.getEnabledElement)(a).viewport,i=[a.clientWidth,a.clientHeight],l=t.clippingRange[1]/i[1]*1.5,c=t.position,s=t.focalPoint,d=t.viewPlaneNormal,u=[-d[0],-d[1],-d[2]],v=r.canvas[1]*l,h=v*u[0];c[0]+=h,s[0]+=h,h=v*u[1],c[1]+=h,s[1]+=h,h=v*u[2],c[2]+=h,s[2]+=h,o.setCamera({position:c,focalPoint:s})})),e.touchDragCallback=e._dragCallback.bind(xn(e)),e.mouseDragCallback=e._dragCallback.bind(xn(e)),e}return r(l,[{key:"_dragCallback",value:function(e){var t=e.detail.element,n=(0,f.getEnabledElement)(t).viewport,a=n.getCamera();a.parallelProjection?this._dragParallelProjection(e,a):this._dragPerspectiveProjection(e,a),n.render()}}]),l}(Mn);var zn={X:[1,0,0],Y:[0,1,0],Z:[0,0,1],CUSTOM:[]},qn=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,l);var a={name:"VolumeRotateMouseWheel",supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:zn.Z,rotateIncrementDegrees:20}};return o(xn(e=i.call(this,t,a)),"_configuration",void 0),e}return r(l,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,a=t.wheel,r=(0,f.getEnabledElement)(n).viewport,o=this.configuration,i=o.direction,l=o.rotateIncrementDegrees,c=r.getCamera(),s=c.viewUp,d=c.position,u=c.focalPoint,v=a.direction,h=M(u,3),g=h[0],m=h[1],p=h[2],b=M(i,3),w=b[0],E=b[1],y=b[2],_=v*l,D=[0,0,0],C=[0,0,0],T=[0,0,0],U=F.mat4.identity(new Float32Array(16));F.mat4.translate(U,U,[g,m,p]),F.mat4.rotate(U,U,_,[w,E,y]),F.mat4.translate(U,U,[-g,-m,-p]),F.vec3.transformMat4(D,d,U),F.vec3.transformMat4(C,u,U),F.mat4.identity(U),F.mat4.rotate(U,U,_,[w,E,y]),F.vec3.transformMat4(T,s,U),r.setCamera({position:D,viewUp:T,focalPoint:C}),r.render()}}]),l}(Mn);function Kn(e){Xn(e,"initial")}function Yn(e){Xn(e,"none")}function Xn(e,t){e.style.cursor=t}var $n=W.vec2.liangBarksyClip,Jn=W.vec3,Zn=Jn.isEqual,Qn=Jn.isOpposite;function ea(){return"rgb(200, 200, 200)"}function ta(){return!0}function na(){return!0}function aa(){return!1}var ra=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}})),"toolCenter",[0,0,0]),o(xn(e),"_getReferenceLineColor",void 0),o(xn(e),"_getReferenceLineControllable",void 0),o(xn(e),"_getReferenceLineDraggableRotatable",void 0),o(xn(e),"_getReferenceLineSlabThicknessControlsOn",void 0),o(xn(e),"editData",void 0),o(xn(e),"getHandleNearImagePoint",(function(t,n,a,r){var o,i,l=t.dataset,c=l.viewportUid,s=l.sceneUid,d=l.renderingEngineUid;if("Active"===(null===(i=(null===(o=kt.getToolGroups(d,s,c)[0])||void 0===o?void 0:o.tools)[e.name])||void 0===i?void 0:i.mode)){var u=(0,f.getEnabledElement)(t).viewport,v=e._getRotationHandleNearImagePoint(u,n,a,r);return null!==v||null!==(v=e._getSlabThicknessHandleNearImagePoint(u,n,a,r))?v:void 0}})),o(xn(e),"handleSelectedCallback",(function(t,n,a){var r=t.detail.element;n.data.active=!0,e._activateModify(r),Yn(r),t.preventDefault()})),o(xn(e),"pointNearTool",(function(t,n,a,r,o){var i,l,c=t.dataset,s=c.viewportUid,d=c.sceneUid,u=c.renderingEngineUid,v=kt.getToolGroups(u,d,s);if("Active"!==(null===(l=(null===(i=v[0])||void 0===i?void 0:i.tools)[e.name])||void 0===l?void 0:l.mode))return!1;for(var h=0;h<v.length&&"Active"!==v[h].tools.Crosshairs.mode;++h);var g=n.data;if(e._pointNearTool(t,n,a,6))return!0;if(0===g.activeViewportUIDs.length){var m=(0,f.getEnabledElement)(t),p=m.viewport.canvasToWorld(a);e._jump(m,p);for(var b=g.handles.rotationPoints,w=[],E=0;E<b.length-1;++E){var y=b[E][1],_=e._getReferenceLineControllable(y.uid),D=e._getReferenceLineDraggableRotatable(y.uid);_&&D&&(w.push(y.uid),E++)}return g.activeViewportUIDs=[].concat(w),g.handles.activeOperation=1,!0}return!1})),o(xn(e),"toolSelectedCallback",(function(t,n){var a=t.detail.element;n.data.active=!0,e._activateModify(a),Yn(a),t.preventDefault()})),o(xn(e),"onCameraModified",(function(t){var n=t.detail.canvas,a=(0,f.getEnabledElement)(n),r=a.FrameOfReferenceUID,o=a.renderingEngine,i=a.viewport,l=Ht(n,e.name),c=ln(a,e.name),s=e.filterInteractableToolStateForElement(n,c);!s.length&&r&&(e._initCrosshairs(t,c),c=ln(a,e.name),s=e.filterInteractableToolStateForElement(n,c));var d=s[0];if(d){var u=i.getCamera(),v=d.metadata.cameraPosition,h=[0,0,0];X().subtract(u.position,v,h);var g=d.metadata.cameraFocalPoint,m=[0,0,0];X().subtract(u.focalPoint,g,m),d.metadata.cameraPosition=x(u.position),d.metadata.cameraFocalPoint=x(u.focalPoint);var p=e._getReferenceLineControllable(i.uid),b=e._getReferenceLineDraggableRotatable(i.uid);if(!Zn(u.position,v,.001)&&p&&b){var w=!0;if(Zn(h,m,.001)||(w=!1),w&&Math.abs(X().dot(h,u.viewPlaneNormal))>.01){for(var E=e._filterLinkedViewportWithSameOrientationAndScene(a,c),y=0;y<E.length;++y){var _=E[y],D=_.data,C=o.getScene(D.sceneUID).getViewport(D.viewportUID),T=C.getCamera(),U=[0,0,0],S=[0,0,0];X().add(T.focalPoint,h,U),X().add(T.position,h,S),_.metadata.cameraPosition=x(u.position),_.metadata.cameraFocalPoint=x(u.focalPoint),C.setCamera({focalPoint:U,position:S})}e.toolCenter[0]+=h[0],e.toolCenter[1]+=h[1],e.toolCenter[2]+=h[2]}}}o.renderViewports(l)})),o(xn(e),"mouseMoveCallback",(function(t,n){for(var a=t.detail,r=a.element,o=a.currentPoints.canvas,i=!1,l=0;l<n.length;l++){var c=n[l],s=c.data;if(s.handles){var d=s.handles.activeOperation,u=s.activeViewportUIDs&&s.activeViewportUIDs.length>0?x(s.activeViewportUIDs):[];s.activeViewportUIDs=[],s.handles.activeOperation=null;var v,f=(v=!!e.getHandleNearImagePoint(r,c,o,6)||e._pointNearTool(r,c,o,6))&&!s.active,h=!v&&s.active;f||h?(s.active=!s.active,i=!0):s.handles.activeOperation===d&&e._areViewportUIDArraysEqual(s.activeViewportUIDs,u)||(i=!0)}}return i})),o(xn(e),"_areViewportUIDArraysEqual",(function(e,t){return e.length===t.length&&(e.forEach((function(e){for(var n=!1,a=0;a<t.length;++a)if(e===t[a]){n=!0;break}if(!1===n)return!1})),!0)})),o(xn(e),"_filterViewportOrientations",(function(e,t){var n=e.viewportUID,a=e.renderingEngine,r=e.viewport,o=t.filter((function(e){return e.data.viewportUID!==n}));if(!o||!o.length)return[];var i=r.getCamera(),l=i.viewPlaneNormal,c=i.position;return o.filter((function(e){var t=e.data,n=t.sceneUID,r=t.viewportUID,o=a.getScene(n).getViewport(r).getCamera();return!(Zn(o.viewPlaneNormal,l,.01)&&Zn(o.position,c,1))}))})),o(xn(e),"_filterLinkedViewportWithSameOrientationAndScene",(function(t,n){var a=t.scene,r=t.renderingEngine,o=t.viewport,i=e._getReferenceLineControllable(o.uid),l=n.filter((function(t){var n=t.data,l=r.getScene(n.sceneUID),c=l.getViewport(n.viewportUID),s=e._getReferenceLineControllable(c.uid);return o!==c&&a===l&&!0===s&&!0===i}));if(!l||!l.length)return[];var c=o.getCamera(),s=c.viewPlaneNormal;return X().normalize(s),l.filter((function(e){var t=e.data,n=t.sceneUID,a=t.viewportUID,o=r.getScene(n).getViewport(a).getCamera(),i=o.viewPlaneNormal;return X().normalize(i),Zn(s,i,.01)&&Zn(c.viewUp,o.viewUp,.01)}))})),o(xn(e),"_filterUniqueViewportOrientations",(function(t,n){var a=t.renderingEngine,r=t.scene,o=t.viewport,i=o.getCamera().viewPlaneNormal;X().normalize(i);for(var l=n.filter((function(t){var n=t.data,i=a.getScene(n.sceneUID),l=i.getViewport(n.viewportUID),c=e._getReferenceLineControllable(l.uid);return o!==l&&r===i&&!0===c})),c=[],s=0;s<l.length;++s){var d=l[s],u=d.data,v=u.sceneUID,f=u.viewportUID,h=a.getScene(v).getViewport(f).getCamera(),g=h.viewPlaneNormal;if(X().normalize(g),!Zn(i,g,.01)&&!Qn(i,g,.01)){for(var m=!1,p=0;p<c.length;++p){var b=c[p].data,w=b.sceneUID,E=b.viewportUID,y=a.getScene(w).getViewport(E).getCamera();Zn(y.viewPlaneNormal,h.viewPlaneNormal,.01)&&Zn(y.position,h.position,1)&&(m=!0)}m||c.push(d)}}for(var _=n.filter((function(t){var n=t.data,i=a.getScene(n.sceneUID),l=i.getViewport(n.viewportUID),c=e._getReferenceLineControllable(l.uid);return o!==l&&r===i&&!0!==c})),D=0;D<_.length;++D){var C=_[D],T=C.data,U=T.sceneUID,S=T.viewportUID,I=a.getScene(U).getViewport(S).getCamera(),k=I.viewPlaneNormal;if(X().normalize(k),!Zn(i,k,.01)&&!Qn(i,k,.01)){for(var M=!1,x=0;x<c.length;++x){var O=c[x].data,L=O.sceneUID,A=O.viewportUID,R=a.getScene(L).getViewport(A).getCamera();Zn(R.viewPlaneNormal,I.viewPlaneNormal,.01)&&Zn(R.position,I.position,1)&&(M=!0)}M||c.push(C)}}for(var P=e._filterViewportOrientations(t,n),N=function(e){var t=P[e];if(!0===c.find((function(e){return e===t})))return"continue";var n=t.data,r=n.sceneUID,o=n.viewportUID,l=a.getScene(r).getViewport(o).getCamera(),s=l.viewPlaneNormal;if(X().normalize(s),Zn(i,s,.01)||Qn(i,s,.01))return"continue";for(var d=!1,u=0;u<c.length;++u){var v=c[u].data,f=v.sceneUID,h=v.viewportUID,g=a.getScene(f).getViewport(h).getCamera();Zn(g.viewPlaneNormal,l.viewPlaneNormal,.01)&&Zn(g.position,l.position,1)&&(d=!0)}d||c.push(t)},V=0;V<P.length;++V)N(V);return c})),o(xn(e),"_initCrosshairs",(function(t,n){var a=t.detail.canvas,r=(0,f.getEnabledElement)(a),o=r.viewport,i=r.FrameOfReferenceUID,l=r.viewportUID,c=r.sceneUID,s=o.sHeight,d=o.sWidth,u=o.canvasToWorld,v=[.5*d,.5*s];e.toolCenter=u(v);var h=o.getCamera(),g=h.position,m=h.focalPoint;cn(0,{metadata:{cameraPosition:x(g),cameraFocalPoint:x(m),FrameOfReferenceUID:i,toolName:e.name},data:{handles:{rotationPoints:[],slabThicknessPoints:[]},active:!1,activeOperation:null,activeViewportUIDs:[],viewportUID:l,sceneUID:c}}),Kn(a)})),o(xn(e),"_jump",(function(t,n){J.isToolLocked=!0;var a=ln(t,e.name),r=t.renderingEngine,o=t.scene,i=[0,0,0];X().subtract(n,e.toolCenter,i);var l=e._filterViewportOrientations(t,a).filter((function(t){var n=t.data,a=r.getScene(n.sceneUID),i=a.getViewport(n.viewportUID);return e._getReferenceLineControllable(i.uid)&&e._getReferenceLineDraggableRotatable(i.uid)&&a===o}));return 0===l.length?(J.isToolLocked=!1,!1):(e._applyDeltaShiftToSelectedViewportCameras(r,l,i),J.isToolLocked=!1,!0)})),o(xn(e),"jumpToWorld",(function(t,n){J.isToolLocked=!0;var a=ln(t,e.name),r=t.renderingEngine,o=t.viewport,i=[0,0,0];X().subtract(n,e.toolCenter,i);var l=a.find((function(e){return e.data.viewportUID===o.uid}));return e._applyDeltaShiftToViewportCamera(r,l,i),J.isToolLocked=!1,!0})),o(xn(e),"_pointNearReferenceLine",(function(t,n,a,r){for(var o=t.data.handles.rotationPoints,i=0;i<o.length-1;++i){var l=o[i][1];if(l.uid===r.uid&&e._getReferenceLineControllable(l.uid)){var c={start:{x:o[i][2][0],y:o[i][2][1]},end:{x:o[i][3][0],y:o[i][3][1]}},s=H.distanceToPoint([c.start.x,c.start.y],[c.end.x,c.end.y],[n[0],n[1]]),d={start:{x:o[i+1][2][0],y:o[i+1][2][1]},end:{x:o[i+1][3][0],y:o[i+1][3][1]}},u=H.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]]);if(s<=a||u<=a)return!0;i++}}return!1})),e._getReferenceLineColor=t.configuration&&t.configuration.getReferenceLineColor||ea,e._getReferenceLineControllable=t.configuration&&t.configuration.getReferenceLineControllable||ta,e._getReferenceLineDraggableRotatable=t.configuration&&t.configuration.getReferenceLineDraggableRotatable||na,e._getReferenceLineSlabThicknessControlsOn=t.configuration&&t.configuration.getReferenceLineSlabThicknessControlsOn||aa,e._activateModify=e._activateModify.bind(xn(e)),e._deactivateModify=e._deactivateModify.bind(xn(e)),e._mouseUpCallback=e._mouseUpCallback.bind(xn(e)),e._mouseDragCallback=e._mouseDragCallback.bind(xn(e)),e}return r(l,[{key:"addNewMeasurement",value:function(e,t){}},{key:"filterInteractableToolStateForElement",value:function(e,t){if(!t||!t.length)return[];var n=(0,f.getEnabledElement)(e).viewportUID;return t.filter((function(e){return e.data.viewportUID===n}))}},{key:"renderToolData",value:function(e,t){for(var n=this,a=e.detail,r=a.renderingEngineUID,o=a.sceneUID,i=a.viewportUID,l=kt.getToolGroups(r,o,i),c=!1,s=0;s<l.length;++s)if("Active"===l[s].tools.Crosshairs.mode){c=!0;break}if(c){var d=e.detail.canvas,u=ln(t.enabledElement,this.name),v=t.enabledElement,f=v.renderingEngine,h=v.viewport,g=h.getCamera(),m=this.filterInteractableToolStateForElement(d,u)[0];if(u&&m&&m.data){var p=m.metadata.toolUID,b=h.sWidth,w=h.sHeight,E=Math.sqrt(b*b+w*w),y=m.data,_=h.worldToCanvas(this.toolCenter),D=this._filterUniqueViewportOrientations(t.enabledElement,u),C=[];D.forEach((function(e){var t=e.data,a=f.getScene(t.sceneUID).getViewport(t.viewportUID),r=a.getCamera(),o=n._getReferenceLineControllable(a.uid),i=n._getReferenceLineDraggableRotatable(a.uid),l=n._getReferenceLineSlabThicknessControlsOn(a.uid),c=a.sWidth,s=a.sHeight,d=Math.sqrt(c*c+s*s),u=[.5*c,.5*s],v=a.canvasToWorld(u),m=[0,0,0];X().cross(g.viewPlaneNormal,r.viewPlaneNormal,m),X().normalize(m),X().multiplyScalar(m,d);var p=[0,0,0];X().add(v,m,p);var b=[0,0,0];X().subtract(v,m,b);var w=h.worldToCanvas(p),y=g.focalPoint,D=h.worldToCanvas(y),T=[D-.5*c,D+.5*c,D-.5*s,D+.5*s],U=h.worldToCanvas(v),S=F.vec2.create();F.vec2.subtract(S,w,U),F.vec2.normalize(S,S);var I=F.vec2.create();F.vec2.scale(I,S,100*E);var k=F.vec2.create();F.vec2.scale(k,S,.25*E);var M=F.vec2.create();F.vec2.scale(M,S,.15*E);var O=F.vec2.create();F.vec2.scale(O,S,.05*E);var L=F.vec2.create(),A=F.vec2.create(),R=F.vec2.create(),P=F.vec2.create(),N=F.vec2.clone(_);i&&o||(N=F.vec2.clone(U)),F.vec2.add(L,N,O),F.vec2.add(A,N,I),F.vec2.subtract(R,N,O),F.vec2.subtract(P,N,I),$n(L,A,T),$n(R,P,T);var V=F.vec2.create();F.vec2.subtract(V,_,k);var B=F.vec2.create();F.vec2.add(B,_,k);var H=F.vec2.clone(_);!i&&l&&(H=F.vec2.clone(U));var j=x(n.toolCenter);!i&&l&&(j=x(v));var W=[0,0,0];X().subtract(p,b,W),X().normalize(W);var G=g.viewPlaneNormal,z=zt().buildFromDegree().rotate(90,G).matrix,q=[0,0,0];F.vec3.transformMat4(q,W,z);var K=a.getSlabThickness(),Y=[].concat(q);X().multiplyScalar(Y,K);var $=[0,0,0];X().add(j,Y,$);var J=h.worldToCanvas($),Z=F.vec2.create();F.vec2.subtract(Z,H,J);var Q=F.vec2.create();F.vec2.subtract(Q,H,I),F.vec2.add(Q,Q,Z);var ee=F.vec2.create();F.vec2.add(ee,H,I),F.vec2.add(ee,ee,Z),$n(Q,ee,T);var te=F.vec2.create();F.vec2.add(te,H,I),F.vec2.subtract(te,te,Z);var ne=F.vec2.create();F.vec2.subtract(ne,H,I),F.vec2.subtract(ne,ne,Z),$n(te,ne,T);var ae=F.vec2.create(),re=F.vec2.create(),oe=F.vec2.create(),ie=F.vec2.create();F.vec2.subtract(ae,H,M),F.vec2.add(ae,ae,Z),F.vec2.add(re,H,M),F.vec2.add(re,re,Z),F.vec2.subtract(oe,H,M),F.vec2.subtract(oe,oe,Z),F.vec2.add(ie,H,M),F.vec2.subtract(ie,ie,Z),C.push([a,L,A,R,P,Q,ee,te,ne,V,B,ae,re,oe,ie])}));var T=[],U=[],S=this._getReferenceLineColor(h.uid),I=void 0!==S?S:"rgb(200, 200, 200)";C.forEach((function(e,a){var r=e[0],o=n._getReferenceLineColor(r.uid),i=n._getReferenceLineControllable(r.uid),l=n._getReferenceLineDraggableRotatable(r.uid),c=n._getReferenceLineSlabThicknessControlsOn(r.uid),s=y.activeViewportUIDs.find((function(e){return e===r.uid})),d=void 0!==o?o:"rgb(200, 200, 200)",u=1,v=null!==y.handles.activeOperation&&1===y.handles.activeOperation&&s;v&&(u=2.5);var f="".concat(a);if(i&&l?(f="".concat(a,"One"),ke(t,n.name,p,f,e[1],e[2],{color:d,lineWidth:u}),f="".concat(a,"Two"),ke(t,n.name,p,f,e[3],e[4],{color:d,lineWidth:u})):ke(t,n.name,p,f,e[2],e[4],{color:d,lineWidth:u}),i){d=void 0!==o?o:"rgb(200, 200, 200)";var g=2===y.handles.activeOperation,m=[e[9],e[10]],b=[h.canvasToWorld(e[9]),r,e[1],e[2]],w=[h.canvasToWorld(e[10]),r,e[3],e[4]];T.push(b,w);var E=3===y.handles.activeOperation,_=[e[11],e[12],e[13],e[14]],D=[h.canvasToWorld(e[11]),r,e[5],e[6]],C=[h.canvasToWorld(e[12]),r,e[5],e[6]],S=[h.canvasToWorld(e[13]),r,e[7],e[8]],I=[h.canvasToWorld(e[14]),r,e[7],e[8]];if(U.push(D,C,S,I),v&&!g&&!E&&l&&c){var k="".concat(a,"One");Ie(t,n.name,p,k,m,{color:d,handleRadius:3,type:"circle"}),k="".concat(a,"Two"),Ie(t,n.name,p,k,_,{color:d,handleRadius:3,type:"rect"})}else if(v&&!g&&!E&&l){var M="".concat(a);Ie(t,n.name,p,M,m,{color:d,handleRadius:3,type:"circle"})}else if(s&&!g&&!E&&c){var x="".concat(a);Ie(t,n.name,p,x,_,{color:d,handleRadius:3,type:"rect"})}else if(g&&l){var O="".concat(a);Ie(t,n.name,p,O,m,{color:d,handleRadius:2,fill:d,type:"circle"})}else E&&s&&c&&Ie(t,n.name,p,f,_,{color:d,handleRadius:2,fill:d,type:"rect"});r.getSlabThickness()>.5&&c&&(f="".concat(a,"STOne"),ke(t,n.name,p,f,e[5],e[6],{color:d,width:1,lineDash:[2,3]}),f="".concat(a,"STTwo"),ke(t,n.name,p,f,e[7],e[8],{color:d,width:e,lineDash:[2,3]}))}})),y.handles.rotationPoints=T,y.handles.slabThicknessPoints=U;var k=[.95*b,.05*w],M=.01*E;!function(e,t,n,a,r,o){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=Object.assign({color:"dodgerblue",fill:"transparent",width:"2",lineWidth:void 0},i),c=l.color,s=l.fill,d=l.width,u=l.lineWidth||d,v="http://www.w3.org/2000/svg",f=Ue(t,n,"circle",a),h=e._getSvgNode(f);if(h)h.setAttribute("cx","".concat(r[0])),h.setAttribute("cy","".concat(r[1])),h.setAttribute("r","".concat(o)),h.setAttribute("stroke",c),h.setAttribute("fill",s),h.setAttribute("stroke-width",u),e._setNodeTouched(f);else{var g=document.createElementNS(v,"circle");g.setAttribute("cx","".concat(r[0])),g.setAttribute("cy","".concat(r[1])),g.setAttribute("r","".concat(o)),g.setAttribute("stroke",c),g.setAttribute("fill",s),g.setAttribute("stroke-width",u),e._appendNode(g,f)}}(t,this.name,p,"0",k,M,{color:I,fill:I})}}}},{key:"_activateModify",value:function(e){J.isToolLocked=!0,e.addEventListener(_.MOUSE_UP,this._mouseUpCallback),e.addEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(_.TOUCH_END,this._mouseUpCallback),e.addEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_deactivateModify",value:function(e){J.isToolLocked=!1,e.removeEventListener(_.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(_.TOUCH_END,this._mouseUpCallback),e.removeEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_mouseUpCallback",value:function(e){var t=e.detail.element;this.editData.toolData.data.active=!1,this.editData.toolData.data.handles.activeOperation=null,this.editData.toolData.data.activeViewportUIDs=[],this._deactivateModify(t),Kn(t),this.editData=null;var n=(0,f.getEnabledElement)(t).renderingEngine,a=Ht(t,this.name);n.renderViewports(a)}},{key:"_mouseDragCallback",value:function(e){var t=this,n=e.detail,a=n.deltaPoints.world;if(!(Math.abs(a[0])<.001&&Math.abs(a[1])<.001&&Math.abs(a[2])<.001)){var r=n.element,o=(0,f.getEnabledElement)(r),i=o.renderingEngine,l=o.viewport,c=ln(o,this.name),s=this.filterInteractableToolStateForElement(r,c)[0];if(s){var d=s.data.handles,u=e.detail.currentPoints.canvas;if(1===d.activeOperation){var v=this._filterViewportOrientations(o,c).filter((function(e){var t=e.data,n=i.getScene(t.sceneUID).getViewport(t.viewportUID);return s.data.activeViewportUIDs.find((function(e){return e===n.uid}))}));this._applyDeltaShiftToSelectedViewportCameras(i,v,a)}else if(2===d.activeOperation){var h=this._filterViewportOrientations(o,c),g=i.getScene(s.data.sceneUID),m=h.filter((function(e){var n=e.data,a=i.getScene(n.sceneUID),r=a.getViewport(n.viewportUID),o=t._getReferenceLineControllable(r.uid),l=t._getReferenceLineDraggableRotatable(r.uid);return g===a&&!0===o&&!0===l})),p=F.vec2.create(),b=F.vec2.create(),w=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],E=l.worldToCanvas(w),y=n.currentPoints.canvas,_=F.vec2.create();F.vec2.sub(_,y,n.deltaPoints.canvas),F.vec2.sub(p,_,E),F.vec2.sub(b,y,E);var D=F.vec2.angle(p,b);this._isClockWise(E,_,y)&&(D*=-1);var C=l.getCamera().viewPlaneNormal,T=zt().buildFromRadian().translate(w[0],w[1],w[2]).rotate(D,C).translate(-w[0],-w[1],-w[2]).matrix;m.forEach((function(e){var t=e.data,n=i.getScene(t.sceneUID).getViewport(t.viewportUID),a=n.getCamera(),r=a.viewUp,o=a.position,l=a.focalPoint;r[0]+=o[0],r[1]+=o[1],r[2]+=o[2],F.vec3.transformMat4(l,l,T),F.vec3.transformMat4(o,o,T),F.vec3.transformMat4(r,r,T),r[0]-=o[0],r[1]-=o[1],r[2]-=o[2],n.setCamera({position:o,viewUp:r,focalPoint:l})}))}else 3===d.activeOperation&&c.filter((function(e){var t=e.data,n=i.getScene(t.sceneUID).getViewport(t.viewportUID);return s.data.activeViewportUIDs.find((function(e){return e===n.uid}))})).forEach((function(e){var r=e.data,o=i.getScene(r.sceneUID).getViewport(r.viewportUID),c=o.getCamera().viewPlaneNormal,d=X().dot(a,c),v=x(c);if(X().multiplyScalar(v,d),Math.abs(v[0])>.001||Math.abs(v[1])>.001||Math.abs(v[2])>.001){var f=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),h=n.lastPoints.world,g=[0,0,0],m=[t.toolCenter[0],t.toolCenter[1],t.toolCenter[2]];if(!t._getReferenceLineDraggableRotatable(o.uid)){var p=t.editData.toolData.data.handles.rotationPoints.filter((function(e){return e[1].uid===o.uid}));if(2===p.length){var b=l.canvasToWorld(p[0][3]),w=l.canvasToWorld(p[1][3]);X().add(b,w,m),X().multiplyScalar(m,.5)}}X().subtract(h,m,g);var E=X().dot(g,c),y=x(c);X().multiplyScalar(y,E);var _=[y[0],y[1],y[2]];F.vec3.normalize(_,_);var D=[v[0],v[1],v[2]];F.vec3.normalize(D,D);var C=o.getSlabThickness();Qn(_,D,.001)?C-=f:C+=f,C=Math.abs(C),C=Math.max(.1,C),t._pointNearReferenceLine(s,u,6,o)?o.setSlabThickness(null):o.setSlabThickness(C)}}))}}}},{key:"_isClockWise",value:function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])>0}},{key:"_applyDeltaShiftToSelectedViewportCameras",value:function(e,t,n){var a=this;t.forEach((function(t){a._applyDeltaShiftToViewportCamera(e,t,n)}))}},{key:"_applyDeltaShiftToViewportCamera",value:function(e,t,n){var a=t.data,r=e.getScene(a.sceneUID).getViewport(a.viewportUID),o=r.getCamera(),i=o.viewPlaneNormal,l=X().dot(n,i),c=x(i);if(X().multiplyScalar(c,l),Math.abs(c[0])>.001||Math.abs(c[1])>.001||Math.abs(c[2])>.001){var s=[0,0,0],d=[0,0,0];X().add(o.focalPoint,c,s),X().add(o.position,c,d),r.setCamera({focalPoint:s,position:d})}}},{key:"_getRotationHandleNearImagePoint",value:function(e,t,n,a){for(var r=t.data,o=r.handles.rotationPoints,i=0;i<o.length;i++){var l=o[i][0],c=o[i][1];if(this._getReferenceLineControllable(c.uid)&&this._getReferenceLineDraggableRotatable(c.uid)){var s=e.worldToCanvas(l);if(F.vec2.distance(n,s)<a)return r.handles.activeOperation=2,this.editData={toolData:t},l}}return null}},{key:"_getSlabThicknessHandleNearImagePoint",value:function(e,t,n,a){for(var r=t.data,o=r.handles.slabThicknessPoints,i=0;i<o.length;i++){var l=o[i][0],c=o[i][1];if(this._getReferenceLineControllable(c.uid)&&this._getReferenceLineSlabThicknessControlsOn(c.uid)){var s=e.worldToCanvas(l);if(F.vec2.distance(n,s)<a)return r.handles.activeOperation=3,r.activeViewportUIDs=[c.uid],this.editData={toolData:t},l}}return null}},{key:"_pointNearTool",value:function(e,t,n,a){for(var r=this,o=(0,f.getEnabledElement)(e).viewport,i=o.sWidth,l=o.sHeight,c=Math.sqrt(i*i+l*l),s=t.data,d=s.handles.rotationPoints,u=s.handles.slabThicknessPoints,v=[],h=0;h<d.length-1;++h){var g=d[h][1],m=this._getReferenceLineControllable(g.uid),p=this._getReferenceLineDraggableRotatable(g.uid);if(m&&p){var b={start:{x:d[h][2][0],y:d[h][2][1]},end:{x:d[h][3][0],y:d[h][3][1]}},w=H.distanceToPoint([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]),E={start:{x:d[h+1][2][0],y:d[h+1][2][1]},end:{x:d[h+1][3][0],y:d[h+1][3][1]}},y=H.distanceToPoint([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]);(w<=a||y<=a)&&(v.push(g.uid),s.handles.activeOperation=1),h++}}for(var _=function(e){var t=u[e][1];if(v.find((function(e){return e===t.uid})))return D=e,"continue";var o=r._getReferenceLineControllable(t.uid),i=r._getReferenceLineSlabThicknessControlsOn(t.uid);if(!o||!i)return D=e,"continue";var l=u[e][2],d=u[e][3],f=F.vec2.create();F.vec2.add(f,l,d),F.vec2.scale(f,f,.5);var h=F.vec2.create();F.vec2.subtract(h,l,f),F.vec2.normalize(h,h);var g=F.vec2.create();F.vec2.scale(g,h,.05*c);var m=F.vec2.create(),p=F.vec2.create();F.vec2.add(m,f,g),F.vec2.subtract(p,f,g);var b={start:{x:m[0],y:m[1]},end:{x:l[0],y:l[1]}},w=H.distanceToPoint([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]),E={start:{x:p[0],y:p[1]},end:{x:d[0],y:d[1]}},y=H.distanceToPoint([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]);(w<=a||y<=a)&&(v.push(t.uid),s.handles.activeOperation=null),e++,D=e},D=0;D<u.length-1;++D)_(D);return s.activeViewportUIDs=[].concat(v),this.editData={toolData:t},1===s.handles.activeOperation}}]),l}(Pn);var oa=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"MIPJumpToClickTool",supportedInteractionTypes:["Mouse","Touch"],configuration:{}})),"_configuration",void 0),o(xn(e),"_bounds",void 0),o(xn(e),"_getTargetVolumeUID",(function(t){if(e.configuration.volumeUID)return e.configuration.volumeUID;var n=t.getVolumeActors();return n||n.length?n[0].uid:void 0})),e}return r(l,[{key:"mouseClickCallback",value:function(e){var t=e.detail,n=t.element,a=t.currentPoints,r=t.renderingEngineUID,o=t.sceneUID,i=(0,f.getEnabledElement)(n),l=i.viewport,c=i.scene,s=i.renderingEngine,d=this._getTargetVolumeUID(c),u=-1/0,v=function(e,t,n,a,r){var o,i=t.getCamera(),l=i.position,c=z(e,i,n).spacingInNormalDirection/4,s=t.getBounds(),d=s[0],u=s[1],v=[0,0,0],f=[0,0,0];X().subtract(r,l,v);for(var h=d;h<=u;h+=c){f=[h,0,0];var g=(h-l[0])/v[0];if(f[1]=g*v[1]+l[1],f[2]=g*v[2]+l[2],$(f,s)){var m=a(t.getIntensityFromWorld(f),f);m&&(o=m)}}return o}(c,l,d,(function(e,t){if(e>u)return u=e,t}),a.world);v&&v.length&&s.getScenesContainingVolume(d).forEach((function(e){e.uid!==o&&e.getViewports().forEach((function(t){kt.getToolGroups(r,e.uid,t.uid).forEach((function(n){var a=n.getToolInstance("Crosshairs");if(a&&a instanceof ra){var r={viewport:t,scene:e,renderingEngine:s,viewportUID:t.uid,sceneUID:o,renderingEngineUID:s.uid,FrameOfReferenceUID:t.getFrameOfReferenceUID()};a.jumpToWorld(r,v)}}))}))}))}}]),l}(Mn);var ia=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_throttledCalculateCachedStats",void 0),o(xn(e),"editData",void 0),o(xn(e),"_configuration",void 0),o(xn(e),"addNewMeasurement",(function(t){var n=t.detail,a=n.currentPoints,r=n.element,o=a.world,i=(0,f.getEnabledElement)(r),c=i.viewport,s=i.FrameOfReferenceUID,d=i.renderingEngine;if(s){var u=c.getCamera(),v=u.viewPlaneNormal,h=u.viewUp,g={metadata:{viewPlaneNormal:x(v),viewUp:x(h),FrameOfReferenceUID:s,toolName:e.name},data:{invalidated:!0,handles:{points:[x(o),x(o),x(o),x(o)],textBox:{hasMoved:!1,worldPosition:[0,0,0]},activeHandleIndex:null},cachedStats:{},active:!0}};f.Settings.getObjectSettings(g,l),cn(0,g);var m=Ht(r,e.name);return e.editData={toolData:g,viewportUIDsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(r),Yn(r),t.preventDefault(),d.renderViewports(m),g}console.warn("No FrameOfReferenceUID, empty scene, exiting early.")})),o(xn(e),"getHandleNearImagePoint",(function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data,i=o.handles,l=i.points,c=i.textBox,s=c.worldBoundingBox;if(s){var d={topLeft:r.worldToCanvas(s.topLeft),topRight:r.worldToCanvas(s.topRight),bottomLeft:r.worldToCanvas(s.bottomLeft),bottmRight:r.worldToCanvas(s.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottmRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottmRight[1])return o.handles.activeHandleIndex=null,c}for(var u=0;u<l.length;u++){var v=l[u],h=r.worldToCanvas(v);if(!0==F.vec2.distance(n,h)<a)return o.handles.activeHandleIndex=u,v}o.handles.activeHandleIndex=null})),o(xn(e),"pointNearTool",(function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data.handles.points,i=r.worldToCanvas(o[0]),l=r.worldToCanvas(o[1]),c={start:{x:i[0],y:i[1]},end:{x:l[0],y:l[1]}},s=H.distanceToPoint([c.start.x,c.start.y],[c.end.x,c.end.y],[n[0],n[1]]);return s<=a||(i=r.worldToCanvas(o[2]),l=r.worldToCanvas(o[3]),c={start:{x:i[0],y:i[1]},end:{x:l[0],y:l[1]}},(s=H.distanceToPoint([c.start.x,c.start.y],[c.end.x,c.end.y],[n[0],n[1]]))<=a||void 0)})),o(xn(e),"toolSelectedCallback",(function(t,n){var a=t.detail.element;n.data.active=!0;var r=Ht(a,e.name);e.editData={toolData:n,viewportUIDsToRender:r,movingTextBox:!1},e._activateModify(a),(0,f.getEnabledElement)(a).renderingEngine.renderViewports(r),Yn(a),t.preventDefault()})),o(xn(e),"handleSelectedCallback",(function(t,n,a){var r=t.detail.element,o=n.data;o.active=!0;var i,l=!1;a.worldPosition?l=!0:i=o.handles.points.findIndex((function(e){return e===a}));var c=Ht(r,e.name);Yn(r),e.editData={toolData:n,viewportUIDsToRender:c,handleIndex:i,movingTextBox:l},e._activateModify(r),(0,f.getEnabledElement)(r).renderingEngine.renderViewports(c),t.preventDefault()})),o(xn(e),"_mouseUpCallback",(function(t){var n=t.detail.element,a=e.editData,r=a.toolData,o=a.viewportUIDsToRender,i=a.newAnnotation,l=a.hasMoved,c=r.data;if(!i||l){c.active=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Kn(n);var s=(0,f.getEnabledElement)(n).renderingEngine;if(void 0!==e.editData.handleIndex){var d=c.handles.points,u=F.vec3.distance(d[0],d[1]);if(F.vec3.distance(d[2],d[3])>u){var v=[x(d[2]),x(d[3])],h=x(d[0]),g=x(d[1]),m=F.vec2.create();F.vec2.set(m,v[1][0]-v[0][0],v[1][1]-v[1][0]);var p=F.vec2.create();F.vec2.set(p,-m[1],m[0]);var b,w=F.vec2.create();F.vec2.set(w,g[0]-h[0],g[1]-h[0]),b=F.vec2.dot(w,p)>0?[h,g]:[g,h],c.handles.points=[v[0],v[1],b[0],b[1]]}}e.editData=null,s.renderViewports(o)}})),o(xn(e),"_mouseDragDrawCallback",(function(t){var n=t.detail,a=n.currentPoints,r=n.element,o=(0,f.getEnabledElement)(r),i=o.renderingEngine,l=o.viewport,c=l.worldToCanvas,s=e.editData,d=s.toolData,u=s.viewportUIDsToRender,v=s.handleIndex,h=d.data,g=a.world;h.handles.points[v]=x(g);var m=h.handles.points.map(c),p={x:m[0][0],y:m[0][1]},b={x:m[1][0],y:m[1][1]},w=(m[2][0],m[2][1],m[3][0],m[3][1],F.vec2.distance(m[0],m[1])/3),E=p.x-b.x,y=p.y-b.y,_=Math.sqrt(E*E+y*y),D=E/_,C=y/_,T=(p.x+b.x)/2,U=(p.y+b.y)/2,S=T+w*C,I=U-w*D,k=T-w*C,M=U+w*D;h.handles.points[2]=l.canvasToWorld([S,I]),h.handles.points[3]=l.canvasToWorld([k,M]),h.invalidated=!0,i.renderViewports(u),e.editData.hasMoved=!0})),o(xn(e),"_mouseDragModifyCallback",(function(t){var n=t.detail,a=n.element,r=(0,f.getEnabledElement)(a).renderingEngine,o=e.editData,i=o.toolData,l=o.viewportUIDsToRender,c=o.handleIndex,s=o.movingTextBox,d=i.data;if(s){var u=n.deltaPoints.world,v=d.handles.textBox,h=v.worldPosition;h[0]+=u[0],h[1]+=u[1],h[2]+=u[2],v.hasMoved=!0}else if(void 0===c){var g=n.deltaPoints.world;d.handles.points.forEach((function(e){e[0]+=g[0],e[1]+=g[1],e[2]+=g[2]}))}else e._mouseDragModifyHandle(t);d.invalidated=!0,r.renderViewports(l)})),o(xn(e),"_mouseDragModifyHandle",(function(t){var n=t.detail,a=n.currentPoints,r=n.element,o=(0,f.getEnabledElement)(r).viewport,i=e.editData,l=i.toolData,c=i.handleIndex,s=l.data,d=a.world,u=[o.worldToCanvas(s.handles.points[0]),o.worldToCanvas(s.handles.points[1]),o.worldToCanvas(s.handles.points[2]),o.worldToCanvas(s.handles.points[3])],v={start:{x:u[0][0],y:u[0][1]},end:{x:u[1][0],y:u[1][1]}},h={start:{x:u[2][0],y:u[2][1]},end:{x:u[3][0],y:u[3][1]}},g=x(d),m=o.worldToCanvas(g);if(0===c||1===c){var p=u[0===c?1:0],b={start:{x:p[0],y:p[1]},end:{x:m[0],y:m[1]}};if(e._movingLongAxisWouldPutItThroughShortAxis(b,h))return;var w=H.intersectLine([h.start.x,h.start.y],[h.end.x,h.end.y],[v.start.x,v.start.y],[v.end.x,v.end.y]),E=F.vec2.create();F.vec2.set(E,w[0],w[1]);var y=F.vec2.distance(u[2],E),_=F.vec2.distance(u[3],E),D=Math.abs(F.vec2.distance(p,E)),C=p[0]-m[0],T=p[1]-m[1],U=Math.sqrt(C*C+T*T),S=C/U,I=T/U,k=p[0]-D*S,M=p[1]-D*I,O=0===c?-1:1,L=k+y*I*O,A=M-y*S*O,R=k-_*I*O,P=M+_*S*O;s.handles.points[c]=g,s.handles.points[2]=o.canvasToWorld([L,A]),s.handles.points[3]=o.canvasToWorld([R,P])}else{var N=2===c?3:2,V={x:m[0],y:m[1]},B={longLineSegment:{start:v.start,end:v.end},shortLineSegment:{start:h.start,end:h.end}},j=B.longLineSegment.start.x-B.longLineSegment.end.x,W=B.longLineSegment.start.y-B.longLineSegment.end.y,G=Math.sqrt(j*j+W*W),z=j/G,q=W/G,K=(0===c||3===c?1:-1)*Number.MAX_SAFE_INTEGER,Y={start:V,end:{x:V.x+q*K,y:V.y+z*K*-1}},X=H.intersectLine([B.longLineSegment.start.x,B.longLineSegment.start.y],[B.longLineSegment.end.x,B.longLineSegment.end.y],[Y.start.x,Y.start.y],[Y.end.x,Y.end.y]);if(void 0===X)return;var $=F.vec2.distance(u[N],[X[0],X[1]]),J={start:{x:X[0]+q*$,y:X[1]+z*$*-1},end:{x:X[0]+q*$*-1,y:X[1]+z*$}},Z=2===N?J.start:J.end;s.handles.points[N]=o.canvasToWorld([Z.x,Z.y]),s.handles.points[c]=g}})),o(xn(e),"_movingLongAxisWouldPutItThroughShortAxis",(function(e,t){var n=F.vec2.create();F.vec2.set(n,t.end.x-t.start.x,t.end.y-t.start.y),F.vec2.normalize(n,n);var a={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!H.intersectLine([a.start.x,a.start.y],[a.end.x,a.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])})),o(xn(e),"_activateDraw",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragDrawCallback),t.addEventListener(_.MOUSE_MOVE,e._mouseDragDrawCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragDrawCallback)})),o(xn(e),"_deactivateDraw",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragDrawCallback),t.removeEventListener(_.MOUSE_MOVE,e._mouseDragDrawCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragDrawCallback)})),o(xn(e),"_activateModify",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragModifyCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragModifyCallback)})),o(xn(e),"_deactivateModify",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragModifyCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragModifyCallback)})),o(xn(e),"filterInteractableToolStateForElement",(function(e,t){if(t&&t.length){var n=(0,f.getEnabledElement)(e),a=n.viewport,r=n.scene,o=a.getCamera();return q(t,o,z(r,o).spacingInNormalDirection)}})),o(xn(e),"_getTextLines",(function(e){var t=e.cachedStats,n=t.length,a=t.width;if(void 0!==n)return["L: ".concat(n.toFixed(2)," mm"),"W: ".concat(a.toFixed(2)," mm")]})),o(xn(e),"_calculateCachedStats",(function(e){var t=e.handles.points[0],n=e.handles.points[1],a=e.handles.points[2],r=e.handles.points[3],o=Math.sqrt(X().distance2BetweenPoints(t,n)),i=Math.sqrt(X().distance2BetweenPoints(a,r)),l=o>i?o:i,c=o>i?i:o;e.cachedStats={length:l,width:c},e.invalidated=!1})),o(xn(e),"_isInsideVolume",(function(e,t,n){return jt(e,n)&&jt(t,n)})),o(xn(e),"_clipIndexToVolume",(function(e,t){for(var n=0;n<=2;n++)e[n]<0?e[n]=0:e[n]>=t[n]&&(e[n]=t[n]-1)})),o(xn(e),"_getTargetVolumeUID",(function(t){if(e.configuration.volumeUID)return e.configuration.volumeUID;var n=t.getVolumeActors();return n||n.length?n[0].uid:void 0})),e._throttledCalculateCachedStats=an(e._calculateCachedStats,100,{trailing:!0}),e}return r(l,[{key:"renderToolData",value:function(e,t){var n=e.detail.canvas,a=ln(t.enabledElement,this.name);if(a&&(a=this.filterInteractableToolStateForElement(n,a)).length)for(var r=t.enabledElement.viewport,o=0;o<a.length;o++){var i=a[o],c=f.Settings.getObjectSettings(i,l),s=i.metadata.toolUID,d=i.data,u=d.handles,v=u.points,h=u.activeHandleIndex,g=v.map((function(e){return r.worldToCanvas(e)})),m=this.getStyle(c,"lineWidth",i),p=this.getStyle(c,"lineDash",i),b=this.getStyle(c,"color",i);d.invalidated&&this._throttledCalculateCachedStats(d);var w=void 0;this.editData||null===h||(w=[g[h]]),w&&Ie(t,this.name,s,"0",w,{color:b}),ke(t,this.name,s,"0",g[0],g[1],{color:b,lineDash:p,lineWidth:m}),ke(t,this.name,s,"1",g[2],g[3],{color:b,lineDash:p,lineWidth:m});var E=this._getTextLines(d);if(E&&0!==E.length){var y=void 0;d.handles.textBox.hasMoved||(y=Wt(g),d.handles.textBox.worldPosition=r.canvasToWorld(y));var _=r.worldToCanvas(d.handles.textBox.worldPosition),D=Pe(t,this.name,s,"1",E,_,g,{},this.getLinkedTextBoxStyle(c,i)),C=D.x,T=D.y,U=D.width,S=D.height;d.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([C,T]),topRight:r.canvasToWorld([C+U,T]),bottomLeft:r.canvasToWorld([C,T+S]),bottomRight:r.canvasToWorld([C+U,T+S])}}}}}]),l}(Pn);var la=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"Length",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_throttledCalculateCachedStats",void 0),o(xn(e),"editData",void 0),o(xn(e),"_configuration",void 0),e._activateModify=e._activateModify.bind(xn(e)),e._deactivateModify=e._deactivateModify.bind(xn(e)),e._mouseUpCallback=e._mouseUpCallback.bind(xn(e)),e._mouseDragCallback=e._mouseDragCallback.bind(xn(e)),e._throttledCalculateCachedStats=an(e._calculateCachedStats,100,{trailing:!0}),e}return r(l,[{key:"addNewMeasurement",value:function(e){var t=e.detail,n=t.currentPoints,a=t.element,r=n.world,o=(0,f.getEnabledElement)(a),i=o.viewport,c=o.renderingEngine;Yn(a);var s,d=i.getCamera(),u=d.viewPlaneNormal,v=d.viewUp;if(i instanceof f.StackViewport)s=i.getCurrentImageId&&i.getCurrentImageId();else{var h=this.configuration.volumeUID;s=function(e,t,n,a){var r=a.direction,o=a.imageIds,i=r.slice(6,9),l=F.vec3.dot(i,t);if(!(Math.abs(l)<.99)){for(var c,s=G(a,t)/2,d=0;d<o.length;d++){var u=o[d],v=f.metaData.get("imagePlaneModule",u).imagePositionPatient,h=F.vec3.create();F.vec3.sub(h,e,v);var g=F.vec3.dot(h,t);Math.abs(g)<s&&(c=u)}return c}}(r,u,0,(0,f.getVolume)(h))}if(s){var g=s.indexOf(":");s=s.substring(g+1)}var m={metadata:{viewPlaneNormal:x(u),viewUp:x(v),FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:s,toolName:this.name},data:{invalidated:!0,handles:{points:[x(r),x(r)],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0]}},cachedStats:{},active:!0}};f.Settings.getObjectSettings(m,l),cn(0,m);var p=Ht(a,this.name);return this.editData={toolData:m,viewportUIDsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),e.preventDefault(),c.renderViewports(p),m}},{key:"getHandleNearImagePoint",value:function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data,i=o.handles,l=i.points,c=i.textBox,s=c.worldBoundingBox;if(s){var d={topLeft:r.worldToCanvas(s.topLeft),topRight:r.worldToCanvas(s.topRight),bottomLeft:r.worldToCanvas(s.bottomLeft),bottomRight:r.worldToCanvas(s.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottomRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottomRight[1])return o.handles.activeHandleIndex=null,c}for(var u=0;u<l.length;u++){var v=l[u],h=r.worldToCanvas(v);if(!0==F.vec2.distance(n,h)<a)return o.handles.activeHandleIndex=u,v}o.handles.activeHandleIndex=null}},{key:"pointNearTool",value:function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=M(t.data.handles.points,2),i=o[0],l=o[1],c=r.worldToCanvas(i),s=r.worldToCanvas(l),d={start:{x:c[0],y:c[1]},end:{x:s[0],y:s[1]}};if(H.distanceToPoint([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]])<=a)return!0}},{key:"toolSelectedCallback",value:function(e,t){var n=e.detail.element;t.data.active=!0;var a=Ht(n,this.name);this.editData={toolData:t,viewportUIDsToRender:a,movingTextBox:!1},this._activateModify(n),Yn(n),(0,f.getEnabledElement)(n).renderingEngine.renderViewports(a),e.preventDefault()}},{key:"handleSelectedCallback",value:function(e,t,n){var a=e.detail.element,r=t.data;r.active=!0;var o,i=!1;n.worldPosition?i=!0:o=r.handles.points.findIndex((function(e){return e===n}));var l=Ht(a,this.name);this.editData={toolData:t,viewportUIDsToRender:l,handleIndex:o,movingTextBox:i},this._activateModify(a),Yn(a),(0,f.getEnabledElement)(a).renderingEngine.renderViewports(l),e.preventDefault()}},{key:"_mouseUpCallback",value:function(e){var t=e.detail.element,n=this.editData,a=n.toolData,r=n.viewportUIDsToRender,o=n.newAnnotation,i=n.hasMoved,l=a.data;o&&!i||(l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(t),this._deactivateDraw(t),Kn(t),(0,f.getEnabledElement)(t).renderingEngine.renderViewports(r),this.editData=null)}},{key:"_mouseDragCallback",value:function(e){var t=e.detail,n=t.element,a=this.editData,r=a.toolData,o=a.viewportUIDsToRender,i=a.handleIndex,l=a.movingTextBox,c=r.data;if(l){var s=t.deltaPoints.world,d=c.handles.textBox,u=d.worldPosition;u[0]+=s[0],u[1]+=s[1],u[2]+=s[2],d.hasMoved=!0}else if(void 0===i){var v=t.deltaPoints.world;c.handles.points.forEach((function(e){e[0]+=v[0],e[1]+=v[1],e[2]+=v[2]}))}else{var h=t.currentPoints.world;c.handles.points[i]=x(h)}c.invalidated=!0,this.editData.hasMoved=!0,(0,f.getEnabledElement)(n).renderingEngine.renderViewports(o)}},{key:"_activateModify",value:function(e){J.isToolLocked=!0,e.addEventListener(_.MOUSE_UP,this._mouseUpCallback),e.addEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(_.TOUCH_END,this._mouseUpCallback),e.addEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_deactivateModify",value:function(e){J.isToolLocked=!1,e.removeEventListener(_.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(_.TOUCH_END,this._mouseUpCallback),e.removeEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_activateDraw",value:function(e){J.isToolLocked=!0,e.addEventListener(_.MOUSE_UP,this._mouseUpCallback),e.addEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(_.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(_.TOUCH_END,this._mouseUpCallback),e.addEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_deactivateDraw",value:function(e){J.isToolLocked=!1,e.removeEventListener(_.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(_.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(_.TOUCH_END,this._mouseUpCallback),e.removeEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"filterInteractableToolStateForElement",value:function(e,t){if(t&&t.length)return function(e,t){if(e instanceof f.StackViewport){var n=e.getCurrentImageId(),a=n.indexOf(":");return n=n.substring(a+1),t.filter((function(e){return e.metadata.referencedImageId===n}))}if(e instanceof f.VolumeViewport){var r=e.getScene(),o=e.getCamera();return q(t,o,z(r,o).spacingInNormalDirection)}throw new Error("Viewport Type ".concat(e.type," not supported"))}((0,f.getEnabledElement)(e).viewport,t)}},{key:"renderToolData",value:function(e,t){var n=e.detail.canvas,a=ln(t.enabledElement,this.name);if(a&&(a=this.filterInteractableToolStateForElement(n,a)).length){var r,o=t.enabledElement.viewport;if(o.type===f.VIEWPORT_TYPE.STACK)r="targetVolumeUID";else{if(o.type!==f.VIEWPORT_TYPE.ORTHOGRAPHIC)throw new Error("Viewport Type not supported: ".concat(o.type));var i=o.getScene();r=this._getTargetVolumeUID(i)}for(var c=0;c<a.length;c++){var s=a[c],d=f.Settings.getObjectSettings(s,l),u=s.metadata.toolUID,v=s.data,h=v.handles,g=h.points,m=h.activeHandleIndex,p=g.map((function(e){return o.worldToCanvas(e)})),b=this.getStyle(d,"lineWidth",s),w=this.getStyle(d,"lineDash",s),E=this.getStyle(d,"color",s),y=void 0;this.editData||null===m||(y=[p[m]]),y&&Ie(t,this.name,u,"0",p,{color:E}),ke(t,this.name,u,"1",p[0],p[1],{color:E,lineDash:w,lineWidth:b}),v.cachedStats[r]?v.invalidated&&this._throttledCalculateCachedStats(v):(v.cachedStats[r]={},this._calculateCachedStats(v));var _=this._getTextLines(v,r);if(!v.handles.textBox.hasMoved){var D=Wt(p);v.handles.textBox.worldPosition=o.canvasToWorld(D)}var C=o.worldToCanvas(v.handles.textBox.worldPosition),T=Pe(t,this.name,u,"1",_,C,p,{},this.getLinkedTextBoxStyle(d,s)),U=T.x,S=T.y,I=T.width,k=T.height;v.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([U,S]),topRight:o.canvasToWorld([U+I,S]),bottomLeft:o.canvasToWorld([U,S+k]),bottomRight:o.canvasToWorld([U+I,S+k])}}}}},{key:"_findTextBoxAnchorPoints",value:function(e){return[e[0],e[1],[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]]}},{key:"_getTextLines",value:function(e,t){var n=e.cachedStats[t].length;if(void 0!==n)return["".concat(n.toFixed(2)," mm")]}},{key:"_calculateCachedStats",value:function(e){for(var t=e.handles.points[0],n=e.handles.points[1],a=e.cachedStats,r=Object.keys(a),o=0;o<r.length;o++){var i=r[o],l=Math.sqrt(X().distance2BetweenPoints(t,n));a[i]={length:l}}return e.invalidated=!1,a}},{key:"_isInsideVolume",value:function(e,t,n){return jt(e,n)&&jt(t,n)}},{key:"_clipIndexToVolume",value:function(e,t){for(var n=0;n<=2;n++)e[n]<0?e[n]=0:e[n]>=t[n]&&(e[n]=t[n]-1)}},{key:"_getTargetVolumeUID",value:function(e){if(this.configuration.volumeUID)return this.configuration.volumeUID;var t=e.getVolumeActors();return t||t.length?t[0].uid:void 0}}]),l}(Pn);var ca=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,l);var a={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}};return o(xn(e=i.call(this,t,a)),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"editData",void 0),o(xn(e),"_configuration",void 0),e._activateModify=e._activateModify.bind(xn(e)),e._deactivateModify=e._deactivateModify.bind(xn(e)),e._mouseUpCallback=e._mouseUpCallback.bind(xn(e)),e._mouseDragCallback=e._mouseDragCallback.bind(xn(e)),e}return r(l,[{key:"pointNearTool",value:function(){return!1}},{key:"toolSelectedCallback",value:function(){}},{key:"addNewMeasurement",value:function(e){var t,n=e.detail,a=n.currentPoints,r=n.element,o=a.world,i=(0,f.getEnabledElement)(r),c=i.viewport,s=i.renderingEngine,d=c.getCamera(),u=d.viewPlaneNormal,v=d.viewUp;c instanceof f.StackViewport&&(t=c.getCurrentImageId());var h={metadata:{viewPlaneNormal:x(u),viewUp:x(v),FrameOfReferenceUID:c.getFrameOfReferenceUID(),referencedImageId:t,toolName:this.name},data:{invalidated:!0,handles:{points:[x(o)]},cachedStats:{},active:!0}};f.Settings.getObjectSettings(h,l),cn(0,h);var g=Ht(r,this.name);return this.editData={toolData:h,viewportUIDsToRender:g},this._activateModify(r),Yn(r),e.preventDefault(),s.renderViewports(g),h}},{key:"getHandleNearImagePoint",value:function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data.handles.points[0],i=r.worldToCanvas(o),l=F.vec2.distance(n,i)<a;return!0===l?o:l}},{key:"handleSelectedCallback",value:function(e,t,n){var a=e.detail.element;t.data.active=!0;var r=Ht(a,this.name);this.editData={toolData:t,viewportUIDsToRender:r},this._activateModify(a),Yn(a),(0,f.getEnabledElement)(a).renderingEngine.renderViewports(r),e.preventDefault()}},{key:"_mouseUpCallback",value:function(e){var t=e.detail.element,n=this.editData,a=n.toolData,r=n.viewportUIDsToRender;a.data.active=!1,this._deactivateModify(t),Kn(t),(0,f.getEnabledElement)(t).renderingEngine.renderViewports(r),this.editData=null}},{key:"_mouseDragCallback",value:function(e){var t=e.detail,n=t.currentPoints,a=t.element,r=n.world,o=this.editData,i=o.toolData,l=o.viewportUIDsToRender,c=i.data;c.handles.points[0]=x(r),c.invalidated=!0,(0,f.getEnabledElement)(a).renderingEngine.renderViewports(l)}},{key:"_activateModify",value:function(e){J.isToolLocked=!0,e.addEventListener(_.MOUSE_UP,this._mouseUpCallback),e.addEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(_.TOUCH_END,this._mouseUpCallback),e.addEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"_deactivateModify",value:function(e){J.isToolLocked=!1,e.removeEventListener(_.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(_.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(_.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(_.TOUCH_END,this._mouseUpCallback),e.removeEventListener(_.TOUCH_DRAG,this._mouseDragCallback)}},{key:"filterInteractableToolStateForElement",value:function(e,t){if(t&&t.length){var n=(0,f.getEnabledElement)(e),a=n.viewport,r=n.scene,o=a.getCamera();return q(t,o,z(r,o).spacingInNormalDirection)}}},{key:"renderToolData",value:function(e,t){var n=e.detail.canvas,a=ln(t.enabledElement,this.name);if(a&&(a=this.filterInteractableToolStateForElement(n,a)).length)for(var r=t.enabledElement,o=r.viewport,i=r.scene,c=this._getTargetVolumeUID(i),s=0;s<a.length;s++){var d=a[s],u=f.Settings.getObjectSettings(d,l),v=d.metadata.toolUID,h=d.data,g=h.handles.points[0],m=o.worldToCanvas(g),p=this.getStyle(u,"color",d);h.cachedStats[c]?h.invalidated&&this._calculateCachedStats(h):(h.cachedStats[c]={},this._calculateCachedStats(h)),Ie(t,this.name,v,"0",[m],{color:p});var b=this._getTextLines(h,c);if(b){var w=[m[0]+6,m[1]-6];Le(t,this.name,v,"0",b,[w[0],w[1]],this.getLinkedTextBoxStyle(u,d))}}}},{key:"_getTextLines",value:function(e,t){var n=e.cachedStats[t],a=n.index,r=n.value,o=n.Modality;if(void 0!==r){var i=[];if(i.push("(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")")),"PT"===o){var l=(0,f.getVolume)(t);if(l.scaling.PET&&(l.scaling.PET.suvbwToSuvbsa||l.scaling.PET.suvbwToSuvlbm)){var c=l.scaling.PET,s=c.suvbwToSuvlbm,d=c.suvbwToSuvbsa;if(i.push("".concat(r.toFixed(2)," SUV bw")),s){var u=r*s;i.push("".concat(u.toFixed(2)," SUV lbm"))}if(s){var v=r*d;i.push("".concat(v.toFixed(2)," SUV bsa"))}}else i.push("".concat(r.toFixed(2)," SUV"))}else"CT"===o?i.push("".concat(r.toFixed(2)," HU")):i.push("".concat(r.toFixed(2)," MO"));return i}}},{key:"_calculateCachedStats",value:function(e){for(var t=e.handles.points[0],n=e.cachedStats,a=Object.keys(n),r=0;r<a.length;r++){var o=a[r],i=(0,f.getVolume)(o),l=i.dimensions,c=i.scalarData,s=i.vtkImageData,d=i.metadata,u=[0,0,0];if(s.worldToIndexVec3(t,u),u[0]=Math.floor(u[0]),u[1]=Math.floor(u[1]),u[2]=Math.floor(u[2]),jt(u,l)){var v=l[0],h=l[0]*l[1],g=c[u[2]*h+u[1]*v+u[0]];n[o]={index:u,value:g,Modality:d.Modality}}else n[o]={index:u,Modality:d.Modality}}e.invalidated=!1}},{key:"_getTargetVolumeUID",value:function(e){if(this.configuration.volumeUID)return this.configuration.volumeUID;var t=e.getVolumeActors();return t||t.length?t[0].uid:void 0}}]),l}(Pn);var sa=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}})),"_throttledCalculateCachedStats",void 0),o(xn(e),"editData",void 0),o(xn(e),"_configuration",void 0),o(xn(e),"addNewMeasurement",(function(t){var n=t.detail,a=n.currentPoints,r=n.element,o=a.world,i=(0,f.getEnabledElement)(r),c=i.viewport,s=i.FrameOfReferenceUID,d=i.renderingEngine;if(s){var u=c.getCamera(),v=u.viewPlaneNormal,h=u.viewUp,g={metadata:{viewPlaneNormal:x(v),viewUp:x(h),FrameOfReferenceUID:s,toolName:e.name},data:{invalidated:!0,handles:{points:[x(o),x(o),x(o),x(o)],textBox:{hasMoved:!1,worldPosition:[0,0,0]},activeHandleIndex:null},cachedStats:{},active:!0}};f.Settings.getObjectSettings(g,l),cn(0,g);var m=Ht(r,e.name);return e.editData={toolData:g,viewportUIDsToRender:m,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(r),Yn(r),t.preventDefault(),d.renderViewports(m),g}console.warn("No FrameOfReferenceUID, empty scene, exiting early.")})),o(xn(e),"getHandleNearImagePoint",(function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data,i=o.handles,l=i.points,c=i.textBox,s=c.worldBoundingBox;if(s){var d={topLeft:r.worldToCanvas(s.topLeft),topRight:r.worldToCanvas(s.topRight),bottomLeft:r.worldToCanvas(s.bottomLeft),bottmRight:r.worldToCanvas(s.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottmRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottmRight[1])return o.handles.activeHandleIndex=null,c}for(var u=0;u<l.length;u++){var v=l[u],h=r.worldToCanvas(v);if(!0==F.vec2.distance(n,h)<a)return o.handles.activeHandleIndex=u,v}o.handles.activeHandleIndex=null})),o(xn(e),"pointNearTool",(function(t,n,a,r){var o=(0,f.getEnabledElement)(t).viewport,i=n.data.handles.points,l=o.worldToCanvas(i[0]),c=o.worldToCanvas(i[3]),s=e._getRectangleImageCoordinates([l,c]),d=[a[0],a[1]],u=s.left,v=s.top,h=s.width,g=s.height;if(j.distanceToPoint([u,v,h,g],d)<=r)return!0})),o(xn(e),"toolSelectedCallback",(function(t,n){var a=t.detail.element;n.data.active=!0;var r=Ht(a,e.name);e.editData={toolData:n,viewportUIDsToRender:r,movingTextBox:!1},e._activateModify(a),Yn(a),(0,f.getEnabledElement)(a).renderingEngine.renderViewports(r),t.preventDefault()})),o(xn(e),"handleSelectedCallback",(function(t,n,a){var r=t.detail.element,o=n.data;o.active=!0;var i,l=!1;a.worldPosition?l=!0:i=o.handles.points.findIndex((function(e){return e===a}));var c=Ht(r,e.name);e.editData={toolData:n,viewportUIDsToRender:c,handleIndex:i,movingTextBox:l},e._activateModify(r),Yn(r),(0,f.getEnabledElement)(r).renderingEngine.renderViewports(c),t.preventDefault()})),o(xn(e),"_mouseUpCallback",(function(t){var n=t.detail.element,a=e.editData,r=a.toolData,o=a.viewportUIDsToRender,i=a.newAnnotation,l=a.hasMoved,c=r.data;i&&!l||(c.active=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Kn(n),(0,f.getEnabledElement)(n).renderingEngine.renderViewports(o),e.editData=null)})),o(xn(e),"_mouseDragCallback",(function(t){var n=t.detail,a=n.element,r=e.editData,o=r.toolData,i=r.viewportUIDsToRender,l=r.handleIndex,c=r.movingTextBox,s=o.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var h=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=h[0],e[1]+=h[1],e[2]+=h[2]}))}else{var g,m,p,b,w,E,y,_,D=n.currentPoints,C=(0,f.getEnabledElement)(a).viewport,T=C.worldToCanvas,U=C.canvasToWorld,S=D.world,I=s.handles.points;switch(I[l]=x(S),l){case 0:case 3:g=T(I[0]),m=[(b=T(I[3]))[0],g[1]],p=[g[0],b[1]],E=U(m),y=U(p),I[1]=E,I[2]=y;break;case 1:case 2:m=T(I[1]),g=[(p=T(I[2]))[0],m[1]],b=[m[0],p[1]],w=U(g),_=U(b),I[0]=w,I[3]=_}}s.invalidated=!0,e.editData.hasMoved=!0,(0,f.getEnabledElement)(a).renderingEngine.renderViewports(i)})),o(xn(e),"_activateDraw",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragCallback),t.addEventListener(_.MOUSE_MOVE,e._mouseDragCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragCallback)})),o(xn(e),"_deactivateDraw",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragCallback),t.removeEventListener(_.MOUSE_MOVE,e._mouseDragCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragCallback)})),o(xn(e),"_activateModify",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragCallback)})),o(xn(e),"_deactivateModify",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragCallback)})),o(xn(e),"filterInteractableToolStateForElement",(function(e,t){if(t&&t.length){var n=(0,f.getEnabledElement)(e),a=n.viewport,r=n.scene,o=a.getCamera();return q(t,o,z(r,o).spacingInNormalDirection)}})),o(xn(e),"_findTextBoxAnchorPoints",(function(t){var n=e._getRectangleImageCoordinates(t),a=n.left,r=n.top,o=n.width,i=n.height;return[[a+o/2,r],[a,r+i/2],[a+o/2,r+i],[a+o,r+i/2]]})),o(xn(e),"_getRectangleImageCoordinates",(function(e){var t=M(e,2),n=t[0],a=t[1];return{left:Math.min(n[0],a[0]),top:Math.min(n[1],a[1]),width:Math.abs(n[0]-a[0]),height:Math.abs(n[1]-a[1])}})),o(xn(e),"_getTextLines",(function(e,t){var n=e.cachedStats[t],a=n.area,r=n.mean,o=n.stdDev,i=n.Modality;if(void 0!==r){var l=[],c="Area: ".concat(a.toFixed(2)," mm").concat(String.fromCharCode(178)),s="Mean: ".concat(r.toFixed(2)),d="Std Dev: ".concat(o.toFixed(2));return"PT"===i?(s+=" SUV",d+=" SUV"):"CT"===i?(s+=" HU",d+=" HU"):(s+=" MO",d+=" MO"),l.push(c),l.push(s),l.push(d),l}})),o(xn(e),"_calculateCachedStats",(function(t,n,a){for(var r=t.handles.points[0],o=t.handles.points[3],i=t.cachedStats,l=Object.keys(i),c=0;c<l.length;c++){var s=l[c],d=(0,f.getVolume)(s),u=d.dimensions,v=d.scalarData,h=d.vtkImageData,g=d.metadata,m=F.vec3.fromValues(0,0,0),p=F.vec3.fromValues(0,0,0);if(h.worldToIndexVec3(r,m),m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m[2]=Math.floor(m[2]),h.worldToIndexVec3(o,p),p[0]=Math.floor(p[0]),p[1]=Math.floor(p[1]),p[2]=Math.floor(p[2]),e._isInsideVolume(m,p,u)){for(var b=Math.min(m[0],p[0]),w=Math.max(m[0],p[0]),E=Math.min(m[1],p[1]),y=Math.max(m[1],p[1]),_=Math.min(m[2],p[2]),D=Math.max(m[2],p[2]),C=K(n,a,d,r,o),T=C.worldWidth*C.worldHeight,U=0,S=0,I=0,k=u[0],M=u[0]*u[1],x=_;x<=D;x++)for(var O=E;O<=y;O++)for(var L=b;L<=w;L++)U++,S+=v[x*M+O*k+L];S/=U;for(var A=_;A<=D;A++)for(var R=E;R<=y;R++)for(var P=b;P<=w;P++){var N=v[A*M+R*k+P]-S;I+=N*N}I/=U,I=Math.sqrt(I),i[s]={Modality:g.Modality,area:T,mean:S,stdDev:I}}else i[s]={Modality:g.Modality}}return t.invalidated=!1,i})),o(xn(e),"_isInsideVolume",(function(e,t,n){return jt(e,n)&&jt(t,n)})),o(xn(e),"_getTargetVolumeUID",(function(t){if(e.configuration.volumeUID)return e.configuration.volumeUID;var n=t.getVolumeActors();return n||n.length?n[0].uid:void 0})),e._throttledCalculateCachedStats=an(e._calculateCachedStats,100,{trailing:!0}),e}return r(l,[{key:"renderToolData",value:function(e,t){var n=e.detail.canvas,a=ln(t.enabledElement,this.name);if(a&&(a=this.filterInteractableToolStateForElement(n,a)).length)for(var r=t.enabledElement,o=r.viewport,i=r.scene,c=this._getTargetVolumeUID(i),s=0;s<a.length;s++){var d=a[s],u=f.Settings.getObjectSettings(d,l),v=d.metadata.toolUID,h=d.data,g=h.handles,m=g.points,p=g.activeHandleIndex,b=m.map((function(e){return o.worldToCanvas(e)})),w=this.getStyle(u,"lineWidth",d),E=this.getStyle(u,"lineDash",d),y=this.getStyle(u,"color",d);if(h.cachedStats[c]){if(h.invalidated){var _=o.getCamera(),D=_.viewPlaneNormal,C=_.viewUp;this._throttledCalculateCachedStats(h,D,C)}}else{h.cachedStats[c]={};var T=o.getCamera(),U=T.viewPlaneNormal,S=T.viewUp;this._calculateCachedStats(h,U,S)}var I=void 0;this.editData||null===p||(I=[b[p]]),I&&Ie(t,this.name,v,"0",I,{color:y}),Ne(t,this.name,v,"0",b[0],b[3],{color:y,lineDash:E,lineWidth:w});var k=this._getTextLines(h,c);if(k&&0!==k.length){if(!h.handles.textBox.hasMoved){var M=Wt(b);h.handles.textBox.worldPosition=o.canvasToWorld(M)}var x=o.worldToCanvas(h.handles.textBox.worldPosition),O=Pe(t,this.name,v,"1",k,x,b,{},this.getLinkedTextBoxStyle(u,d)),L=O.x,A=O.y,R=O.width,P=O.height;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([L,A]),topRight:o.canvasToWorld([L+R,A]),bottomLeft:o.canvasToWorld([L,A+P]),bottomRight:o.canvasToWorld([L+R,A+P])}}}}}]),l}(Pn);var da=function(e){Ln(l,e);var t,a,i=(t=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Rn(t);if(a){var r=Rn(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return An(this,e)});function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,l),o(xn(e=i.call(this,t,{name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0}})),"touchDragCallback",void 0),o(xn(e),"mouseDragCallback",void 0),o(xn(e),"_throttledCalculateCachedStats",void 0),o(xn(e),"editData",void 0),o(xn(e),"_configuration",void 0),o(xn(e),"addNewMeasurement",(function(t){var n=t.detail,a=n.currentPoints,r=n.element,o=a.world,i=a.canvas,c=(0,f.getEnabledElement)(r),s=c.viewport,d=c.FrameOfReferenceUID,u=c.renderingEngine;if(d){var v=s.getCamera(),h=v.viewPlaneNormal,g=v.viewUp,m={metadata:{viewPlaneNormal:x(h),viewUp:x(g),FrameOfReferenceUID:d,toolName:e.name},data:{invalidated:!0,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0]},points:[x(o),x(o),x(o),x(o)],activeHandleIndex:null},isDrawing:!0,cachedStats:{},active:!0}};f.Settings.getObjectSettings(m,l),cn(0,m);var p=Ht(r,e.name);return e.editData={toolData:m,viewportUIDsToRender:p,centerCanvas:i,newAnnotation:!0,hasMoved:!1},e._activateDraw(r),Yn(r),t.preventDefault(),u.renderViewports(p),m}console.warn("No FrameOfReferenceUID, empty scene, exiting early.")})),o(xn(e),"getHandleNearImagePoint",(function(e,t,n,a){var r=(0,f.getEnabledElement)(e).viewport,o=t.data,i=o.handles,l=i.points,c=i.textBox,s=c.worldBoundingBox;if(s){var d={topLeft:r.worldToCanvas(s.topLeft),topRight:r.worldToCanvas(s.topRight),bottomLeft:r.worldToCanvas(s.bottomLeft),bottmRight:r.worldToCanvas(s.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottmRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottmRight[1])return o.handles.activeHandleIndex=null,c}for(var u=0;u<l.length;u++){var v=l[u],h=r.worldToCanvas(v);if(!0==F.vec2.distance(n,h)<a)return o.handles.activeHandleIndex=u,v}o.handles.activeHandleIndex=null})),o(xn(e),"pointNearTool",(function(t,n,a,r){var o=(0,f.getEnabledElement)(t).viewport,i=n.data.handles.points.map((function(e){return o.worldToCanvas(e)})),l=M(e._getCanvasEllipseCorners(i),2),c=l[0],s=l[1],d={left:Math.min(c[0],s[0])+r/2,top:Math.min(c[1],s[1])+r/2,width:Math.abs(c[0]-s[0])-r,height:Math.abs(c[1]-s[1])-r},u={left:Math.min(c[0],s[0])-r/2,top:Math.min(c[1],s[1])-r/2,width:Math.abs(c[0]-s[0])+r,height:Math.abs(c[1]-s[1])+r},v=P(d,a);if(P(u,a)&&!v)return!0})),o(xn(e),"toolSelectedCallback",(function(t,n){var a=t.detail.element;n.data.active=!0;var r=Ht(a,e.name);e.editData={toolData:n,viewportUIDsToRender:r,movingTextBox:!1},Yn(a),e._activateModify(a),(0,f.getEnabledElement)(a).renderingEngine.renderViewports(r),t.preventDefault()})),o(xn(e),"handleSelectedCallback",(function(t,n,a){var r=t.detail.element,o=n.data;o.active=!0;var i,l,c,s,d,u=!1;if(a.worldPosition)u=!0;else{var v=o.handles.points,h=(0,f.getEnabledElement)(r).viewport.worldToCanvas;i=v.findIndex((function(e){return e===a}));var g=v.map(h);d=g[i],c=Math.abs(g[2][0]-g[3][0]),s=Math.abs(g[0][1]-g[1][1]),l=[(g[2][0]+g[3][0])/2,(g[0][1]+g[1][1])/2]}var m=Ht(r,e.name);e.editData={toolData:n,viewportUIDsToRender:m,handleIndex:i,canvasWidth:c,canvasHeight:s,centerCanvas:l,originalHandleCanvas:d,movingTextBox:u},e._activateModify(r),Yn(r),(0,f.getEnabledElement)(r).renderingEngine.renderViewports(m),t.preventDefault()})),o(xn(e),"_mouseUpCallback",(function(t){var n=t.detail.element,a=e.editData,r=a.toolData,o=a.viewportUIDsToRender,i=a.newAnnotation,l=a.hasMoved,c=r.data;if(!i||l){c.active=!1,c.handles.activeHandleIndex=null,delete c.isDrawing,delete c.isDrawing,e._deactivateModify(n),e._deactivateDraw(n),Kn(n);var s=(0,f.getEnabledElement)(n).renderingEngine;e.editData=null,s.renderViewports(o)}})),o(xn(e),"_mouseDragDrawCallback",(function(t){var n=t.detail,a=n.element,r=n.currentPoints.canvas,o=(0,f.getEnabledElement)(a),i=o.renderingEngine,l=o.viewport.canvasToWorld,c=e.editData,s=c.toolData,d=c.viewportUIDsToRender,u=c.centerCanvas,v=s.data,h=Math.abs(r[0]-u[0]),g=Math.abs(r[1]-u[1]),m=[u[0],u[1]-g],p=[u[0],u[1]+g],b=[u[0]-h,u[1]],w=[u[0]+h,u[1]];v.handles.points=[l(m),l(p),l(b),l(w)],v.invalidated=!0,e.editData.hasMoved=!0,i.renderViewports(d)})),o(xn(e),"_mouseDragModifyCallback",(function(t){var n=t.detail,a=n.element,r=e.editData,o=r.toolData,i=r.viewportUIDsToRender,l=r.handleIndex,c=r.movingTextBox,s=o.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var h=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=h[0],e[1]+=h[1],e[2]+=h[2]}))}else e._dragHandle(t);s.invalidated=!0,(0,f.getEnabledElement)(a).renderingEngine.renderViewports(i)})),o(xn(e),"_dragHandle",(function(t){var n=t.detail,a=n.element,r=(0,f.getEnabledElement)(a).viewport.canvasToWorld,o=e.editData,i=o.toolData,l=o.canvasWidth,c=o.canvasHeight,s=o.handleIndex,d=o.centerCanvas,u=o.originalHandleCanvas,v=i.data.handles.points,h=n.currentPoints.canvas;if(0===s||1===s){var g=Math.abs(h[1]-d[1]),m=[d[0],d[1]-g],p=[d[0],d[1]+g];v[0]=r(m),v[1]=r(p);var b=l/2+(h[0]-u[0]),w=[d[0]-b,d[1]],E=[d[0]+b,d[1]];v[2]=r(w),v[3]=r(E)}else{var y=Math.abs(h[0]-d[0]),_=[d[0]-y,d[1]],D=[d[0]+y,d[1]];v[2]=r(_),v[3]=r(D);var C=c/2+(h[1]-u[1]),T=[d[0],d[1]-C],U=[d[0],d[1]+C];v[0]=r(T),v[1]=r(U)}})),o(xn(e),"_activateModify",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragModifyCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragModifyCallback)})),o(xn(e),"_deactivateModify",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragModifyCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragModifyCallback)})),o(xn(e),"_activateDraw",(function(t){J.isToolLocked=!0,t.addEventListener(_.MOUSE_UP,e._mouseUpCallback),t.addEventListener(_.MOUSE_DRAG,e._mouseDragDrawCallback),t.addEventListener(_.MOUSE_MOVE,e._mouseDragDrawCallback),t.addEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.addEventListener(_.TOUCH_END,e._mouseUpCallback),t.addEventListener(_.TOUCH_DRAG,e._mouseDragDrawCallback)})),o(xn(e),"_deactivateDraw",(function(t){J.isToolLocked=!1,t.removeEventListener(_.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(_.MOUSE_DRAG,e._mouseDragDrawCallback),t.removeEventListener(_.MOUSE_MOVE,e._mouseDragDrawCallback),t.removeEventListener(_.MOUSE_CLICK,e._mouseUpCallback),t.removeEventListener(_.TOUCH_END,e._mouseUpCallback),t.removeEventListener(_.TOUCH_DRAG,e._mouseDragDrawCallback)})),o(xn(e),"filterInteractableToolStateForElement",(function(e,t){if(t&&t.length){var n=(0,f.getEnabledElement)(e),a=n.viewport,r=n.scene,o=a.getCamera();return q(t,o,z(r,o).spacingInNormalDirection)}})),o(xn(e),"_getCanvasEllipseCorners",(function(e){var t=M(e,4),n=t[0],a=t[1],r=t[2],o=t[3];return[[r[0],a[1]],[o[0],n[1]]]})),o(xn(e),"_getTextLines",(function(e,t){var n=e.cachedStats[t],a=n.area,r=n.mean,o=n.stdDev,i=n.isEmptyArea,l=n.Modality;if(void 0!==r){var c=[],s=i?"Area: Oblique not supported":"Area: ".concat(a.toFixed(2)," mm").concat(String.fromCharCode(178)),d="Mean: ".concat(r.toFixed(2)),u="Std Dev: ".concat(o.toFixed(2));return"PT"===l?(d+=" SUV",u+=" SUV"):"CT"===l?(d+=" HU",u+=" HU"):(d+=" MO",u+=" MO"),c.push(s),c.push(d),c.push(u),c}})),o(xn(e),"_calculateCachedStats",(function(t,n,a){for(var r=M(a,2),o=r[0],i=r[1],l=n.canvasToWorld(o),c=n.canvasToWorld(i),s=n.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=t.cachedStats,h={left:Math.min(o[0],i[0]),top:Math.min(o[1],i[1]),width:Math.abs(o[0]-i[0]),height:Math.abs(o[1]-i[1])},g=Object.keys(v),m=0;m<g.length;m++){var p=g[m],b=(0,f.getVolume)(p),w=b.dimensions,E=b.scalarData,y=b.vtkImageData,_=b.metadata,D=F.vec3.fromValues(0,0,0),C=F.vec3.fromValues(0,0,0);if(y.worldToIndexVec3(l,D),D[0]=Math.floor(D[0]),D[1]=Math.floor(D[1]),D[2]=Math.floor(D[2]),y.worldToIndexVec3(c,C),C[0]=Math.floor(C[0]),C[1]=Math.floor(C[1]),C[2]=Math.floor(C[2]),e._isInsideVolume(D,C,w)){var T=Math.min(D[0],C[0]),U=Math.max(D[0],C[0]),S=Math.min(D[1],C[1]),I=Math.max(D[1],C[1]),k=Math.min(D[2],C[2]),x=Math.max(D[2],C[2]),O=K(d,u,b,l,c),L=O.worldWidth,A=O.worldHeight,R=0===L&&0===A,N=Math.PI*(L/2)*(A/2),V=0,B=0,H=0,j=w[0],W=w[0]*w[1],G=F.vec3.fromValues(T,S,k),z=F.vec3.create();y.indexToWorldVec3(G,z);var q=n.worldToCanvas(z),Y=F.vec3.fromValues(T+1,S,k),X=F.vec3.fromValues(T,S+1,k),$=F.vec3.fromValues(T,S,k+1),J=F.vec3.create(),Z=F.vec2.create();y.indexToWorldVec3(Y,J);var Q=n.worldToCanvas(J);F.vec2.sub(Z,Q,q);var ee=F.vec3.create(),te=F.vec2.create();y.indexToWorldVec3(X,ee);var ne=n.worldToCanvas(ee);F.vec2.sub(te,ne,q);var ae=F.vec3.create(),re=F.vec2.create();y.indexToWorldVec3($,ae);var oe=n.worldToCanvas(ae);F.vec2.sub(re,oe,q);for(var ie=k;ie<=x;ie++)for(var le=S;le<=I;le++)for(var ce=T;ce<=U;ce++){var se=ce-T,de=le-S,ue=ie-k,ve=[q[0],q[1]];P(h,ve=[ve[0]+Z[0]*se+te[0]*de+re[0]*ue,ve[1]+Z[1]*se+te[1]*de+re[1]*ue])&&(V++,B+=E[ie*W+le*j+ce])}B/=V;for(var fe=k;fe<=x;fe++)for(var he=S;he<=I;he++)for(var ge=T;ge<=U;ge++){var me=E[fe*W+he*j+ge]-B;H+=me*me}H/=V,H=Math.sqrt(H),v[p]={Modality:_.Modality,area:N,mean:B,stdDev:H,isEmptyArea:R}}else v[p]={Modality:_.Modality}}return t.invalidated=!1,v})),o(xn(e),"_isInsideVolume",(function(e,t,n){return jt(e,n)&&jt(t,n)})),o(xn(e),"_getTargetVolumeUID",(function(t){if(e.configuration.volumeUID)return e.configuration.volumeUID;var n=t.getVolumeActors();return n||n.length?n[0].uid:void 0})),e._throttledCalculateCachedStats=an(e._calculateCachedStats,100,{trailing:!0}),e}return r(l,[{key:"renderToolData",value:function(e,t){var n=e.detail.canvas,a=ln(t.enabledElement,this.name);if(a&&(a=this.filterInteractableToolStateForElement(n,a)).length)for(var r=t.enabledElement,o=r.viewport,i=r.scene,c=this._getTargetVolumeUID(i),s=0;s<a.length;s++){var d=a[s],u=f.Settings.getObjectSettings(d,l),v=d.metadata.toolUID,h=d.data,g=h.handles,m=h.isDrawing,p=g.points,b=g.activeHandleIndex,w=this.getStyle(u,"lineWidth",d),E=this.getStyle(u,"lineDash",d),y=this.getStyle(u,"color",d),_=p.map((function(e){return o.worldToCanvas(e)})),D=this._getCanvasEllipseCorners(_);h.cachedStats[c]?h.invalidated&&this._throttledCalculateCachedStats(h,o,D):(h.cachedStats[c]={},this._calculateCachedStats(h,o,D));var C=void 0;this.editData||null===b||(C=[_[b]]),C&&Ie(t,this.name,v,"0",C,{color:y}),Se(t,this.name,v,"0",D[0],D[1],{color:y,lineDash:E,lineWidth:w});var T=this._getTextLines(h,c);if(T&&0!==T.length&&!m){var U=void 0;h.handles.textBox.hasMoved||(U=Wt(D),h.handles.textBox.worldPosition=o.canvasToWorld(U));var S=o.worldToCanvas(h.handles.textBox.worldPosition),I=Pe(t,this.name,v,"1",T,S,_,{},this.getLinkedTextBoxStyle(u,d)),k=I.x,M=I.y,x=I.width,O=I.height;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([k,M]),topRight:o.canvasToWorld([k+x,M]),bottomLeft:o.canvasToWorld([k,M+O]),bottomRight:o.canvasToWorld([k+x,M+O])}}}}}]),l}(Pn)}(),c}()}));
//# sourceMappingURL=index.js.map